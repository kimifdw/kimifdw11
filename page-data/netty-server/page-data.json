{"componentChunkName":"component---src-templates-blog-post-js","path":"/netty-server/","result":{"data":{"site":{"siteMetadata":{"title":"FDW-blog","author":"kimifdw"}},"markdownRemark":{"id":"cdfbc258-f861-5464-93ef-85a008aca6e9","html":"<h2 id=\"channel源码\"><a href=\"#channel%E6%BA%90%E7%A0%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>channel源码</h2>\n<ul>\n<li>简介到网络套接字或IO操作的组件，如读、写、连接和绑定。类图如下：\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/79f3cb95e27bc67d20f5b5aeaf8e5926/1bba8/channel-4.1.53.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 76.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAACMElEQVQoz3VSaXObMBT0//8tnTaO06a53DYzSRsfBEyAxCYnwRFI4pDEoQOoiD+0Tdyd0czT0+6+5Q0DjHGWZXlOCGGEMsaKnLAQxDBGGCcIYggRQpgQqhma9srUNdWqgVKy67qErK9vx5773V4cuc6PNA+X96ee8825GjtXJ44ztheH69AjNcjIbQSWMVxxUWix0mIhqlVoRvFdoE2e7aLMX+IlAH6wvlkFJoKPz+vrJH2pOMEkDNCqLBIp60FZlzmNKIEpAYxhQiEmgDdCW1aqRjRMSZTSSHdk23Al6r7ow2oMAAame2Qan3+eDefT0Wyy4zmnbdfqt7LMJvbH6eTT1NhtJO/e4TV2z+yyTEjZ6EIf2apa1bKRlBeVrIggur9xfCPuM7ygwPGOHfvYto/m89FTsNDNoiLe7di9OllYh+blPgDL3qJt/53cdawkGD+tw3vfX2H8SCnWTalEkgTryPcDC6MnypK3kxultBkr06JAeQ4xjhhDlKK2bTSKUq8wxtmaUcR58U7co3X9X5a5N7nYPT/bmU2HlvlVKVFxtvC+GMbo/OKDXmT47G6PvYGULaXylfHHXjQi5/9ZmD4wBc7N2LYOF9bBpbFvWwfGfATAqtsMalvVqG4bBvqtrGgc3yP4EAT+zbWHUQDjx7qiG4ZWcsW3i/UX/32vRQMTlGBASBSjBwDvypq23XYMqqrinNd1JQTXIWmZG+7YmA2nk91Z/8MN8yzq5yvVvMNvSgtIMn5S6sIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/79f3cb95e27bc67d20f5b5aeaf8e5926/fcda8/channel-4.1.53.png\"\n        srcset=\"/static/79f3cb95e27bc67d20f5b5aeaf8e5926/12f09/channel-4.1.53.png 148w,\n/static/79f3cb95e27bc67d20f5b5aeaf8e5926/e4a3f/channel-4.1.53.png 295w,\n/static/79f3cb95e27bc67d20f5b5aeaf8e5926/fcda8/channel-4.1.53.png 590w,\n/static/79f3cb95e27bc67d20f5b5aeaf8e5926/1bba8/channel-4.1.53.png 642w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li><code class=\"language-text\">Unsafe</code>。用于数据传输</li>\n<li><code class=\"language-text\">AbstractNioChannel</code>。NIO的基本操作</li>\n<li>通过<code class=\"language-text\">pipeline</code>来进行事件操作和流转。</li>\n</ul>\n<h2 id=\"channelpipeline\"><a href=\"#channelpipeline\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ChannelPipeline</h2>\n<blockquote>\n<p>拦截器，维护ChannelHandler列表，类似于servlet和filter的关系</p>\n</blockquote>\n<h3 id=\"创建\"><a href=\"#%E5%88%9B%E5%BB%BA\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>创建</h3>\n<ul>\n<li>\n<p>每个通道都有自己的管道，它会在创建新通道时自动创建</p>\n<h3 id=\"特性\"><a href=\"#%E7%89%B9%E6%80%A7\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>特性</h3>\n</li>\n<li>\n<p>支持运行时动态添加或删除<code class=\"language-text\">ChannelHandler</code>,线程安全</p>\n<h3 id=\"流程图如下\"><a href=\"#%E6%B5%81%E7%A8%8B%E5%9B%BE%E5%A6%82%E4%B8%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>流程图如下</h3>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1abb8304aa0ae00b6084a0d689c787cf/61c63/channel-pipline-flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 117.56756756756756%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsSAAALEgHS3X78AAABpUlEQVQ4y32UjW7DIAyE+/6v2WmbWkVZk0CAAN3hS1xC0t6kiAHGn3/qiw325m75mZ/vFWP0PuDb7F9SSh/MgvfjON5v99+f7+v16+/x8N6/jI/vqXLO8zwbM/V933VdLzLG7Iwh+I+bsF6WZRbBD9EUEC/q+oJ7R3K85Jx3viiLQgi0bIyLK8RmrYUrfGGAFzVV3Aetcw5PJNHOM76wIWrAP1siYkFwPPKhnOTamEGutNVBkzllOYkZPEAmNlzFyrNiM5wddlRs51bsEOIBmwG3xhLgdjWtIeRKSqvMer/EjJqADZ00DvgbV3wpMoGHAdvDNBnCvYy1zsuCehXCpufgzYm01G22tfq6rnPLjHLdZjtKkxhgoY+niYnhMRbTNHLfWoOuy+lQKvpinulePVOlPYrPfFJnctYhNEl+19vFGHkCG/JsjWmwsY9afOptbW9mu27YRcSIoDbbSst7aS/eVp+8u+swnQfbjVjPBplhXo9OhkHBDuG0SSSiQPJDneUxt0mdbK4wkmRfyNuYvYyRMnekn9HA6Gy3TQ/L3+Q8q6Ua/wMRe4gLW/fW8AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/1abb8304aa0ae00b6084a0d689c787cf/fcda8/channel-pipline-flow.png\"\n        srcset=\"/static/1abb8304aa0ae00b6084a0d689c787cf/12f09/channel-pipline-flow.png 148w,\n/static/1abb8304aa0ae00b6084a0d689c787cf/e4a3f/channel-pipline-flow.png 295w,\n/static/1abb8304aa0ae00b6084a0d689c787cf/fcda8/channel-pipline-flow.png 590w,\n/static/1abb8304aa0ae00b6084a0d689c787cf/61c63/channel-pipline-flow.png 693w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n</li>\n<li><code class=\"language-text\">ChannelInboundHandler</code>。监控Channel状态变化，API如下图所示：\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/89e841656f970119064f16658e500f27/87254/ChannelInboundHandler-api.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 89.86486486486487%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAACTElEQVQ4y62S227TQBCG/f4X0BIkXgIJmkaI0gukQkElEgXixHYSkrjx2etjEtvx6Wd2W1AEARXISJ/Hszs7+ndnpDCKwFiAOI5h2g7mCx2O6wpmszlkeYjRSIGqahgOR1DIG4YJ07RgU75F+IwJ4iSBVGQrpIEHx9Dh2wYC14LvGFjFARJat25mYs9azmHfLLCOGcpNAmYvwRxTxG2ZocxSMDor9RUd3WsVLz9oOH2n4sXVGD3yZ/2v6M9iXE1DIhBcaj7eqgxviNeyTTi4GHm4HAe4oLXrGYP0rK/j+FTBk95HPDj5jOPnn3B0QpDvdCnufsGj0wE6PRkPewo65ws8Pp8TCwGPO6/mODqb4+l7HRJQA2jRZjHS0ENA1w5JesIchHSlyLPFf+RZWNN+k6/we2sgbYotinUGjwppkwkGA1k8vCyPRCOUkQpF0aBpE2jjMUzLQVnVqJsWVd38gMdlWUHKqGBDpBGD47iwTRPL5RKmYcCybFjUTY5tWbRPqsOIDjd79W23W0j5tkS1yaljBsakUKHRkAc0KuRVRcGQK1VUUqhhOpmSahW6riNJU2RZhtVqhYIEccvzHFJV12io6CaNaZZ8MJ8JJa7riX+PVDOaMU5A8+rRfEY0u7xIQ0prfv5OccELfg+athEbu0l/Yp+VZUFvSLK5tW2LvzGev8vtlTf0hiRzX8J92D0nrlyQwpw+/6LwZ7W3XaaCxQELlmUJic/OoQoWBXW52Cn4P/yi8BAmBpuPDa/M4Q3iird3VFUl1rm/Dzz3G5gRXc73iCPmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/89e841656f970119064f16658e500f27/fcda8/ChannelInboundHandler-api.png\"\n        srcset=\"/static/89e841656f970119064f16658e500f27/12f09/ChannelInboundHandler-api.png 148w,\n/static/89e841656f970119064f16658e500f27/e4a3f/ChannelInboundHandler-api.png 295w,\n/static/89e841656f970119064f16658e500f27/fcda8/ChannelInboundHandler-api.png 590w,\n/static/89e841656f970119064f16658e500f27/87254/ChannelInboundHandler-api.png 604w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li><code class=\"language-text\">ChannelOutboundHandler</code>。拦截IO事件，API如下图所示：\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/da5231c3c9573a7e59451175329c7852/d72eb/ChannelOutboundHandler-api.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 587px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 87.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAAB00lEQVQ4y82R7U/TUBSH+99rgtFPmoxoYuIHjU4CvoAoiPL2jRlIxjboe7uOdV03Nl3L+vJ4WiJZVIgk++BJfvfcnJ773N89VTYPbaq7R1S/Nljea4parOyfsH5gsXbg8HK7ydKeKj0nvNpu8V5qa7U2z7fqvNg6prrTYrXmsvqtzfJ+C+XZrk5lo8aTzxqLH5s83jih8qFBZb3Bg7d1Ft4cc3fpiDui+++al/vXh9yT+sJKnYefDBa/ODzatHm646BQxOQH0djnzDHxLJ2OqeEaKr5rEnRsAs/GM0/LPOi2iUchaTQij8eQTCCLIZ9CGqNcJAmTwZB+2MNx2xiGheO4mKZdyrYd2l4H3TAxTAtP9pbUzvwe4/F3wlDO9geEwhiIlDTLiIdDfN9DVVV0TUcrdKqiqRqGrmNZFq5cYkt2BOa6LlEU8XvkeY6SyRIPz+WWrjiysESmbohTQ5w6JSToh/wZeQmYVZqmhcOU+HwkdnsCNEs3BdSQJxZPL6CFozAc0Ov6BEFAP+gzGo2vXBUqogQmyZSbomjNZCxpmpX5cp+W+a/AYrn6MDOLf4lffdcDb6lrnpzcytVNTkvgdDqdL3DuDmdn+L8C5/1TLqK5An8CnzgW4/EvrtEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/da5231c3c9573a7e59451175329c7852/d72eb/ChannelOutboundHandler-api.png\"\n        srcset=\"/static/da5231c3c9573a7e59451175329c7852/12f09/ChannelOutboundHandler-api.png 148w,\n/static/da5231c3c9573a7e59451175329c7852/e4a3f/ChannelOutboundHandler-api.png 295w,\n/static/da5231c3c9573a7e59451175329c7852/d72eb/ChannelOutboundHandler-api.png 587w\"\n        sizes=\"(max-width: 587px) 100vw, 587px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<h2 id=\"eventloop\"><a href=\"#eventloop\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Eventloop</h2>\n<ul>\n<li>处理注册在channel上的所有IO操作，事件循环器【单线程】</li>\n<li><code class=\"language-text\">EventExecutor</code>。事件执行器，负责处理事件</li>\n<li><code class=\"language-text\">EventExecutorGroup</code>。维护了一个EventExecutor链表，继承了ScheduledExecutorService，execute方法通过next方法选择一个EventExecutor，并调用EventLoop#execute处理事件</li>\n<li><code class=\"language-text\">EventloopGroup</code>。负责调度Eventloop</li>\n<li>\n<p><code class=\"language-text\">NioEventloop</code>。</p>\n<ul>\n<li>启动流程如下图：\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b4bb066d05db7a9e4dc71a89b702a74e/9ac09/NioEventLoop-start.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 82.43243243243244%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA9hAAAPYQGoP6dpAAABHElEQVQoz5WTV47DMAxEdf9rGjbcq9xbXjyIYHixUMIPgSI5LEPJTNO0ruu+78MwLMtynuc8z+h5nqdpGkVRHMdcMeK11nIC6fselKmqqq5rTITiA9w0TZIkbduWZVkUBcYsy7iiBEHASQCWcRwNCQjiBHYcx3nJQ3HXhxhqdl13fESh27ZJYRwUrnJJcQGG6rTBVEpxxziFU66H3ZBDhGkYmICbb8GiEQ0OYRj+sDxa+BdMWQ1ATWgnxQ9tOwdtU1YLdIQ5jAdMtyDhj5OtatVaoR98F702RPO7VfnBXClIC2EY8sJAagXbJf7KEkIpTiLA9hLeAowqkQes/pkcDCkA85BJBB4jQA/4Pst+iYJ5Tu+P4QX/9QKhOMoL5dytVn3UFZgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/b4bb066d05db7a9e4dc71a89b702a74e/fcda8/NioEventLoop-start.png\"\n        srcset=\"/static/b4bb066d05db7a9e4dc71a89b702a74e/12f09/NioEventLoop-start.png 148w,\n/static/b4bb066d05db7a9e4dc71a89b702a74e/e4a3f/NioEventLoop-start.png 295w,\n/static/b4bb066d05db7a9e4dc71a89b702a74e/fcda8/NioEventLoop-start.png 590w,\n/static/b4bb066d05db7a9e4dc71a89b702a74e/efc66/NioEventLoop-start.png 885w,\n/static/b4bb066d05db7a9e4dc71a89b702a74e/c83ae/NioEventLoop-start.png 1180w,\n/static/b4bb066d05db7a9e4dc71a89b702a74e/9ac09/NioEventLoop-start.png 2204w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>实例化流程图如下：\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f4b08314ff679c1ad3f013a4e043565b/d2dd6/NioEventLoop-sequence.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAB7CAAAewgFu0HU+AAAA0klEQVQoz6WR3Q5EMBCFvf8rWhGJhATpUj+lWvtpw3Zxt+einZnOmXOGqKqqLMvGcdRaG2O6rns5EJCu60oQx3Gapk3TbL+I5nl+O7RtK6Xs+76u66Io4MgDCHBuN0TTNEEjstb6Ei6GYQibEGDiA9k6hCVSDIcVzOd5jvkkSTBPyo47mQtl1DC8LAspJ1I6gFJKCFE5+GYqO5mrLEtcMRJBL8tsG8A4PNimjw3Z/Hy+2/aV+4L714YcPpzi6gDOL7SvMktedAAc/p9wIH4mb3/gA/3vSVVDMx4tAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/f4b08314ff679c1ad3f013a4e043565b/fcda8/NioEventLoop-sequence.png\"\n        srcset=\"/static/f4b08314ff679c1ad3f013a4e043565b/12f09/NioEventLoop-sequence.png 148w,\n/static/f4b08314ff679c1ad3f013a4e043565b/e4a3f/NioEventLoop-sequence.png 295w,\n/static/f4b08314ff679c1ad3f013a4e043565b/fcda8/NioEventLoop-sequence.png 590w,\n/static/f4b08314ff679c1ad3f013a4e043565b/efc66/NioEventLoop-sequence.png 885w,\n/static/f4b08314ff679c1ad3f013a4e043565b/c83ae/NioEventLoop-sequence.png 1180w,\n/static/f4b08314ff679c1ad3f013a4e043565b/d2dd6/NioEventLoop-sequence.png 3399w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>\n<p>与<code class=\"language-text\">Channel</code>的关联图如下：\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/96757ff64c2b825df87f7e4e5043aee6/07db2/NioEventLoop-Channel.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 79.05405405405406%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAB7CAAAewgFu0HU+AAABGUlEQVQoz5WTyY6DQAxE+f9v5AIIITax71teKKWnhTIh8QFMt8tll42T53kcx/u+p2nq+/44jsdxJEmCH0WRcbIsC4KAmLZtXdf1PG9ZFmee56IohmEAs23b8bJ1XcmIQxDn+Dg6MVcOR2VZTtN0AQtwccyVnCdzVVVK/zMYTpj7vicF/XwD/iubFx+6q+u6aRo0M33aoe+Z1TARyIawSIqzn3ZTNiS0LTCyd13HiY35xMyFPnAYpib5Q8865YlmMCMeneOMp6mue+b1ZVQOP5vH/uGY7P8y2ybxlG4+zd6wN8wXA0B0GIbsNkJqkPTCaOjlE7NdgrklHXKARBFN5AYsPGzAaIQuEJVfTfh7MEEUjGz6BbQXmt8DzjyspU6WqzIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/96757ff64c2b825df87f7e4e5043aee6/fcda8/NioEventLoop-Channel.png\"\n        srcset=\"/static/96757ff64c2b825df87f7e4e5043aee6/12f09/NioEventLoop-Channel.png 148w,\n/static/96757ff64c2b825df87f7e4e5043aee6/e4a3f/NioEventLoop-Channel.png 295w,\n/static/96757ff64c2b825df87f7e4e5043aee6/fcda8/NioEventLoop-Channel.png 590w,\n/static/96757ff64c2b825df87f7e4e5043aee6/efc66/NioEventLoop-Channel.png 885w,\n/static/96757ff64c2b825df87f7e4e5043aee6/c83ae/NioEventLoop-Channel.png 1180w,\n/static/96757ff64c2b825df87f7e4e5043aee6/07db2/NioEventLoop-Channel.png 3867w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id=\"bytebuf\"><a href=\"#bytebuf\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ByteBuf</h2>\n<h3 id=\"bytebuf简介\"><a href=\"#bytebuf%E7%AE%80%E4%BB%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ByteBuf简介</h3>\n</li>\n</ul>\n</li>\n<li>创建buffer使用Unpooled或Pooled。</li>\n<li><code class=\"language-text\">discardable bytes</code>。无效空间，可丢弃字节的区域</li>\n<li><code class=\"language-text\">readable bytes</code>。内容空间，可读字节的区域，由readerIndex和writerIndex指针控制</li>\n<li><code class=\"language-text\">writable bytes</code>。空闲空间，可写入字节的区域，由writerIndex指针和capacity容量控制</li>\n<li>索引顺序存储。\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ec5a01943984836887aaf1384e4861d/d0d8c/Sequential-Access-Indexing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 28.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAAmklEQVQY042QQQ7FIAhEvf8tm3TRnRG1VkHasTSav/sTJfhg0Oj2cyem+1eq+s/RYTO3GClQiDGmlLBbA4lElF4xc84ZJKcRa63mH2YRqa2OxRV9rTEI/N77EAJaZYkFHSyqfZl77/ppJCBvZEvQ/tX6qg6z3oo7Ddkge2q5LoOlnHgzyLQhB8Egt+XtKMf8BhtvmreZrDoJkgf0i2DILOCIsAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/4ec5a01943984836887aaf1384e4861d/fcda8/Sequential-Access-Indexing.png\"\n        srcset=\"/static/4ec5a01943984836887aaf1384e4861d/12f09/Sequential-Access-Indexing.png 148w,\n/static/4ec5a01943984836887aaf1384e4861d/e4a3f/Sequential-Access-Indexing.png 295w,\n/static/4ec5a01943984836887aaf1384e4861d/fcda8/Sequential-Access-Indexing.png 590w,\n/static/4ec5a01943984836887aaf1384e4861d/d0d8c/Sequential-Access-Indexing.png 609w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>Discardable bytes。回收未使用区域如下图所示：\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d764c86d3d678df53cf6532e1f43d3b7/3dd3e/discardReadBytes-flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABIUlEQVQoz5VSSXKEMAzk/4/knoSqIZZs40UmLYllJjWHpEsYI9NqLZ7mx7ymtbdeTtRa979hqqWWrbTWwNkM/yDj6b1fmidazhkej4XQ2PgnfsL/NxnHgULgwJFTSk5gZvBjjIiJtLA5PzcRuckIPAz7GCLDpQ+PnYI/ToDpp0rGy9PoXTwLiMeYWtWInj88yBZxASTPHBHRyfLLdo36ziy1Z88UaYm8MC0UvsL6Eb4/c3qMzs8m7zYwrVmki5isKFCFeS5z9HPt1jBT1mpbQxtDIK2Wo04G7UXrOVr9MR9rJmJ04WVUiNUM8Prq+roxz4WqbZN7VAQBJr8Sfhkgou0txQfrOlaXjgcXhYiObs9hXvLi9Y4hLxWauHOusbvb9z8A0fyXr/AbTwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/d764c86d3d678df53cf6532e1f43d3b7/fcda8/discardReadBytes-flow.png\"\n        srcset=\"/static/d764c86d3d678df53cf6532e1f43d3b7/12f09/discardReadBytes-flow.png 148w,\n/static/d764c86d3d678df53cf6532e1f43d3b7/e4a3f/discardReadBytes-flow.png 295w,\n/static/d764c86d3d678df53cf6532e1f43d3b7/fcda8/discardReadBytes-flow.png 590w,\n/static/d764c86d3d678df53cf6532e1f43d3b7/3dd3e/discardReadBytes-flow.png 595w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>清除缓存索引。\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/92b2ea151038b818037a86a02cb93408/32056/clearing-index.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 62.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABBklEQVQoz5VS27LDIAj0//8yM33pzOk0JyreQLsB2/iaHUNAWETQPZ/b6+9Ry57TW9jfWq7Wpqsy87gJh6+1ViaySqSqKdFp51wVp5bNW0TkIiPmCMe/P0LwRGRs731KKcaI1OASNIrw5pQucu+dW+sD/w4bEkwQTAesrmmOIczwW7CS9bYmUdt5BhE4oomgYwcKDkRwSdnMSTaM+3BIjN4Alux2t2VB76ve1ezrpgjLt0w3tGFzmxkXRJ/tntZtyOA9JvCNaczLqGDPeyu/watoOiUV5xNaS7pGBSeaHEK0qUIndCHSr4tWuukoxIdQdZZui9te9iFD62Er3vAbwDoLC7B38gFIz/5nb12xeAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/92b2ea151038b818037a86a02cb93408/fcda8/clearing-index.png\"\n        srcset=\"/static/92b2ea151038b818037a86a02cb93408/12f09/clearing-index.png 148w,\n/static/92b2ea151038b818037a86a02cb93408/e4a3f/clearing-index.png 295w,\n/static/92b2ea151038b818037a86a02cb93408/fcda8/clearing-index.png 590w,\n/static/92b2ea151038b818037a86a02cb93408/32056/clearing-index.png 602w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<h3 id=\"命中逻辑及内存回收\"><a href=\"#%E5%91%BD%E4%B8%AD%E9%80%BB%E8%BE%91%E5%8F%8A%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>命中逻辑及内存回收</h3>\n<ol>\n<li>内存规格\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9bcd0afda5b0274c5a2d7098287e3851/f8067/memory-region-cache.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABpElEQVQozz1QiY7jIBTr/3/aarSjdlptM02aO+GGEAKEI13oHpJlGbB5Tz4dR4jR/0VwxyuuU8+rIrEcO/H8XrpaJoxtFmP333wc8RRjCNGF6DOCi68jxWhxE03JyoI9fuHbmZd30T3Tj6KtfHB/nGlqDjut/mFL7J2NwQe/B+8ywpvdnoT3+/72JGcOG07VOFhKDEYbggaCHcFtnnTm2SGo52mDcz6C2SJoIdAYqaG3izil210rIYUymzfb1DZf58+FIKtWScnl/Dm1tVXS+V0Lfr9dn49Cr4tdF0PJKQ20aumHjjESjR6rx+XjBxkGtymJwPXnR1fczSL8bjSjxeX8fb1owdwqc9gSzDGcwIgxxAQ2zxLN06O4c86q8rt9Vm1djWOvzdZ1TV0+hrap6opMgxM8h9XCh7FPYWs2hACE8yqXtEjShCBKMSXIaMUZTU+UIkKwxGjn7KQhCLuFBK9qfb1ehJG6rUMMMwIAAyYYZhhRbHbDOANpRzgDgnIpaW2n5Nq1Fs4mtZpqB7nhLOCcdEK6T6yn0by17Nq170RT+039Bu9BLSvnJ6VYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/9bcd0afda5b0274c5a2d7098287e3851/fcda8/memory-region-cache.png\"\n        srcset=\"/static/9bcd0afda5b0274c5a2d7098287e3851/12f09/memory-region-cache.png 148w,\n/static/9bcd0afda5b0274c5a2d7098287e3851/e4a3f/memory-region-cache.png 295w,\n/static/9bcd0afda5b0274c5a2d7098287e3851/fcda8/memory-region-cache.png 590w,\n/static/9bcd0afda5b0274c5a2d7098287e3851/f8067/memory-region-cache.png 726w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>\n<p>内存分配流程</p>\n<ol>\n<li>PoolThreadCache。线程独有的内存仓库</li>\n<li>PoolArean。几个线程共享的内存仓库</li>\n<li>全局变量指向的内存仓库，为所有线程共用</li>\n<li>PoolChunck。向OS申请的最小内存，默认为16M</li>\n<li>Page。PoolChunk所能管理的最小内存，PageSize默认为8k\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3c31326cfc5834d5bbefe33e4b9f5d57/5bb8b/memory.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAClElEQVQoz03RbU/aUBQAYP/hPm7Jti/7DdsndcuyLEbRxZdZBcUpDnmxFKG8sxZKqdCWlksLgg4d24gycYwhbYHRdgXj2MnJyc3NfXLuuXdK13VFlntyv6/8GfSGRhqLnjyQJUnTNF3VjAP929+XBfZKYBslvp5Ld68bxqauaVNGPb84RxNuH273Jxxo0uXHD3y4E1ROuoOBoo3wzXkdW7BhJhu2sI8+X65lxZFVx7ha/Wz1za97pt/DMxDyEkJmIO8bulToaFozy7XwdKP5O4IL8UQpEhNgH3dRa44bj3H57NSL+QNEMJDwGxkmAqFEsFAU+6rarlTbQvmyc+vkwCEvwEDcZZiTRmOCxdNTM5y2IIw9mN8P5Le9rBWhQaGoqUNV1we63mx3SPCVEr5ni3Wu0mi2lTHWx53L5T1vcvMw+RGlbOixBSGtHoIHQk9Wvp3dZNLlDJbLH4tciufJQhXUet2+Po4RLhaLW27MjKTtwcweSlk8pNmVzIvCVfXa/GQeejq3+Whp59nb9YfQxuPllQfTIJQfP5g6woIgGHjDQ9r81AcftQmnzC6c4TipJXHxYxAlhUhWDOMgCkqRXAUlWl+uJzMDANbtkRUnbvWSFg+x5sRW7XGGzl12WssotojGtoPJJRwzHQZipZM7Nrk2x/PQQWzNRViR9BacWnUm1g4+ZTL0T6kTCvP+KBsPcyjDhfwMqNTufniCaZp5t4OabDHIgRnMtBdd3AmlKKr+49cCmplHqI0QvRVmljyZOUfSGmRH/h8uFAQ7SjnCLBxl3VHGGWGN4WkAKlft10fkrIeYdhOvjpIvdqlZHw7F8/p9TN3PoP6Xw1HVRtGV1a48lBT1VlblvtZsSa12t9dT7sb+C9/5e9ccst8rAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/3c31326cfc5834d5bbefe33e4b9f5d57/fcda8/memory.png\"\n        srcset=\"/static/3c31326cfc5834d5bbefe33e4b9f5d57/12f09/memory.png 148w,\n/static/3c31326cfc5834d5bbefe33e4b9f5d57/e4a3f/memory.png 295w,\n/static/3c31326cfc5834d5bbefe33e4b9f5d57/fcda8/memory.png 590w,\n/static/3c31326cfc5834d5bbefe33e4b9f5d57/5bb8b/memory.png 749w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ol>\n</li>\n<li>\n<p>堆外内存回收</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PooledByteBuf</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractReferenceCountedByteBuf</span> <span class=\"token punctuation\">{</span></code></pre></div>\n</li>\n</ol>\n<p>  @Override\nprotected final void deallocate() {\nif (handle >= 0) {\nfinal long handle = this.handle;\n// 当前的ByteBuf不再指向任何一块内存\nthis.handle = -1;\nmemory = null;\n// 将ByteBuf的内存释放\nchunk.arena.free(chunk, tmpNioBuf, handle, maxLength, cache);\ntmpNioBuf = null;\nchunk = null;\n// 将对象放入的对象回收站，循环利用\nrecycle();\n}\n}\n}</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. ByteBuf释放内存\n```java\nvoid free(PoolChunk&lt;T&gt; chunk, ByteBuffer nioBuffer, long handle, int normCapacity, PoolThreadCache cache) {\n        if (chunk.unpooled) {\n            int size = chunk.chunkSize();\n            destroyChunk(chunk);\n            activeBytesHuge.add(-size);\n            deallocationsHuge.increment();\n        } else {\n            SizeClass sizeClass = sizeClass(handle);\n            if (cache != null &amp;&amp; cache.add(this, chunk, nioBuffer, handle, normCapacity, sizeClass)) {\n                // cached so not free it.\n                return;\n            }\n\n            freeChunk(chunk, handle, normCapacity, sizeClass, nioBuffer, false);\n        }\n    }</code></pre></div>\n<ol>\n<li>\n<p>对象放入回收站，循环利用</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Recycler</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n<span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">recycle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> object<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>object <span class=\"token operator\">!=</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"object does not belong to handle\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\">Stack</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> stack <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>stack<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lastRecycledId <span class=\"token operator\">!=</span> recycleId <span class=\"token operator\">||</span> stack <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"recycled already\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        stack<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ol>","timeToRead":4,"frontmatter":{"title":"netty server","date":"October 31, 2020","spoiler":"netty channel, 源码学习"},"fields":{"slug":"/netty-server/"}}},"pageContext":{"slug":"/netty-server/","previous":{"fields":{"slug":"/interview/","directoryName":"interview"},"frontmatter":{"title":"面试题收集"}},"next":{"fields":{"slug":"/spring-boot/","directoryName":"spring-boot"},"frontmatter":{"title":"spring boot部分源码解读"}}}},"staticQueryHashes":["336482444"]}