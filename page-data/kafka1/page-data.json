{"componentChunkName":"component---src-templates-blog-post-js","path":"/kafka1/","result":{"data":{"site":{"siteMetadata":{"title":"FDW-blog","author":"kimifdw"}},"markdownRemark":{"id":"4530c8da-a14d-5f2d-ae1f-487bdc78afe6","html":"<h2 id=\"消息中间件好处\"><a href=\"#%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%A5%BD%E5%A4%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>消息中间件好处</h2>\n<ol>\n<li>解耦</li>\n<li>异步</li>\n<li>削峰</li>\n</ol>\n<h2 id=\"消息队列的通信模式\"><a href=\"#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%BC%8F\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>消息队列的通信模式</h2>\n<ol>\n<li>点对点。基于<strong>拉取</strong>或者<strong>轮询</strong>的消息传送模型，发送到队列的消息被一个且只有一个消费者进行处理\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/14dcd8ded1a86470488aae045bf38cf9/8d68c/msg-model1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABd0lEQVQoz31Sa2/CMAzM//9PY2ygfYAxUQFqJSijLUxqG/ou0FduTkShYxWWTkkk+5w7m00DE7N4h1VgQzQNuiGEePpuaoEw0glThTT7ARu4Swx9HVN/gziOUVUVLpeLKn5ESxoEAZIkQRJn8PxPuP4LPD6g+h1YIxpItEWO48AwDPRFS2rbNvb7fadZc4UAEzUREoj1VpimKeq6VvcsyxTyPFfv8/mM0+l0l02lNUmXkP3YJLx6GNooi0JJlmSccywWC2y3W1iWheVyCV3XFVlBlpRlQdaUiMjDKJ4opOkBbOiu8ObpmPnm7SfyF4fDAfP5HOv1WpFKQk3TlM/SvzzPiCCHz7/gegPy8hVxYoHdDcI/ydKTlkCefZIfg5VViYLQkBlSbjvpZ0ORSmReTd7LxmUlrSoUB3vnBj6iDWbcVEnNdRf71qa7PjIvChPw4xft4AhBOEKSkuSxq2PsG9D4959d65L23dsJH4MFnP2IVmkEzzPxC75aAVbs3HGJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/14dcd8ded1a86470488aae045bf38cf9/fcda8/msg-model1.png\"\n        srcset=\"/static/14dcd8ded1a86470488aae045bf38cf9/12f09/msg-model1.png 148w,\n/static/14dcd8ded1a86470488aae045bf38cf9/e4a3f/msg-model1.png 295w,\n/static/14dcd8ded1a86470488aae045bf38cf9/fcda8/msg-model1.png 590w,\n/static/14dcd8ded1a86470488aae045bf38cf9/efc66/msg-model1.png 885w,\n/static/14dcd8ded1a86470488aae045bf38cf9/c83ae/msg-model1.png 1180w,\n/static/14dcd8ded1a86470488aae045bf38cf9/8d68c/msg-model1.png 1234w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>发布订阅\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e2eaf44438e619673500081dc6e02c42/c929c/msg-model2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABn0lEQVQoz31Si26bQBC8//+hKlKVVLEapambBqLaAoIgJDSADXfHwzwMTHfPiuVKlldawZ1uZndmV1hFCFtF8PUHMOO/mOf54nkcJ0jlUlpQ6hlKv0Fc52vclh4eti+oyhLTNGG/3xvwueRQSqHrOmw2OZJ0AVXeQJe3SJIniLrdodo16IeeKo6Iogie513sMAxDxHFsig9Dh92uQtvWdB4hMHHv81Euk2qtj+C+7wk0mORo2xZ5npt3hyIgokNyiEcZ4ElHcNVfDARmuQzOsgyO48D3fQRBgNVqhTRNUVUVXNfFdrsl2T0K+Ye8e6S0IGUIcUMeLrSHZe6jqWs0TWO6YunL5dLIZ1Lbto1UJmSykvwuColscwepv5GPC/LTguj6Dm3Xms4+g0Esie+klGYI/GUbuOB6vTa2cPCbjvA8JJYvxv0BOE/z0b9Pv84Fk9akhDvk/4lwjD9sBhHeFy/4qQM8F68odXli9nxxdfhdlm1I8i9amXvKBxqWA/El/o2rxMKP1DFdnq7HKcG5u2EY8ZF8R/h6hSD8ivfYxj/eYv9D7gmNoAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/e2eaf44438e619673500081dc6e02c42/fcda8/msg-model2.png\"\n        srcset=\"/static/e2eaf44438e619673500081dc6e02c42/12f09/msg-model2.png 148w,\n/static/e2eaf44438e619673500081dc6e02c42/e4a3f/msg-model2.png 295w,\n/static/e2eaf44438e619673500081dc6e02c42/fcda8/msg-model2.png 590w,\n/static/e2eaf44438e619673500081dc6e02c42/efc66/msg-model2.png 885w,\n/static/e2eaf44438e619673500081dc6e02c42/c83ae/msg-model2.png 1180w,\n/static/e2eaf44438e619673500081dc6e02c42/c929c/msg-model2.png 1218w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ol>\n<h2 id=\"kafka架构\"><a href=\"#kafka%E6%9E%B6%E6%9E%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kafka架构</h2>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/21d4b6cfae925ab6ec0709941adbad25/b67f3/kafka-architecture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC4klEQVQ4y02SSW/jRhCF9WvzUwLMaZBbLrkNggBzzGbEAwTjGcObbFmybNnaSIpNSSSbbDYXiaQsfSl5EiAEHqqri6h671V30tpnkT7h6iFpo9i1DXU8Y5dMaZM5VTghmt2j3YHcz99qjZ7SxBPqbcl829CPIh7SlKCu6ai6h/96yWJ3QdAOaOSnKhiQLR7YLh+o3EvUc5fluE/h3GDde6L5EDPvYZIVk8wy1ppnnTA1hk5sFdVGmkij2K7Yl5pfviz47qPmw5lHMrni/CXkfGqI3AdGkxmnjwnDqU8UeERxSmFScmkWxBGdsHAptgl5pYkKn9ZqTi4c3v0acno1p/C6nHxd8ttZJCwHjJ5e+HSz5nHkYJOA2FiqoqDIc3yR3vGrPqq9RdkrAiM+VRmjrsPZp4jZ0CWddPnpx5Af3mumdwPG/Rl/nRqeegFGK1Sa4YeaMMvwRHonLULqTUtT7zBZSKEjIm/MehWQLMZUsy4rb4HvK7TTJ/YHLKMxq0VfPAy5MjmXecFFUTKUKJJnZM0SI4hykSiexOorvvqDSH2h8m+I9GdW0SmJeyW1jzje9+j1z2QyPEwNSZIQCzt1ZKjKgWy3T9D0CLZPbKucfO2xsRYbOBSTa6yYXcizSCd3lKsJZR5jojkr5RFnOZuqohKo/yTv6gOvzYHMxuSFRv9+zer9Z9I/rylckXw2YvX3C/nzHbtNyvFrK0saiw3C0CYaKwNVGArDbERYzVmXU5Z2LNMN4fkt4ck96f2A3LlGvzgCDyMLqhKPWh5wEfuylCXPwnBsc0byHp9FemezN5R7kSTYHIzMfqVuDVWbUm4itmVEWR6Zh2KHnO2awh7PMftDQ3rYofct8b4hl9hJ/ZbUOWDcg8S9bFJydy94JXFeSb0D/pPFHYqHi4Ms5ni3f0Pi7MiOcL9Fq6ShGm5QdztUrxXsCATqrv2Gf/PpRcZE8Fb7X/2YL3pbvF6Bd1vhP+b8A3zwvx8My/iLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/21d4b6cfae925ab6ec0709941adbad25/fcda8/kafka-architecture.png\"\n        srcset=\"/static/21d4b6cfae925ab6ec0709941adbad25/12f09/kafka-architecture.png 148w,\n/static/21d4b6cfae925ab6ec0709941adbad25/e4a3f/kafka-architecture.png 295w,\n/static/21d4b6cfae925ab6ec0709941adbad25/fcda8/kafka-architecture.png 590w,\n/static/21d4b6cfae925ab6ec0709941adbad25/efc66/kafka-architecture.png 885w,\n/static/21d4b6cfae925ab6ec0709941adbad25/c83ae/kafka-architecture.png 1180w,\n/static/21d4b6cfae925ab6ec0709941adbad25/b67f3/kafka-architecture.png 1338w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ol>\n<li>消费者组。同一个分区的数据只能被消费者组中的一个消费者消费；同一个消费者组的消费者可以消费同一个topic的不同分区的数据</li>\n</ol>\n<h2 id=\"工作流程分析\"><a href=\"#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>工作流程分析</h2>\n<h3 id=\"发送数据\"><a href=\"#%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>发送数据</h3>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e055571ce85dc16eb54bb723e9b9352b/21482/sendMsg.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 44.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACBUlEQVQozzWS2W7aQBhG8+S9qtTbtu/Qm1bqRaS2UdK02ZQQNgM2JMF4t8fGLDZgbEIwp2NQRzr6rRnpzOdPcyKWL/SDW7r2Ne66zXTtQslhrWKbzG2zDnoUokc8fMRSrrA6VyRmU+6prL0OuV+hsPI1ToJcxdvVcF5rCOrEucF+tz8I81in9B/Yhy1Jk63/SOE8HNgFdUrRYBupZH6XTShnIIUi14hoSzpS2GSydfi/srHOm5TswjY70aKsxFH7QCnZejKIF6A6KQMvxbHNKqFGKEVi3ybI7wjdJvl4Sl5sWIrnYxIprGQVO9E8Un3L9MrQ5/dLzp9hTv9ldExYCUMUxOKv7OeCVERUP51PDLbOHWXQ4E2meZOzHCuUsXKYVULh6PhijBeE+OYTJ34mhTKdv2kxWt8RJAOKaEIRRiTDNvPIwvcMZrPo0NFmcMlaOeN1eCMvqJPFJrEvz4VFEuhSOB2RpDOWaYY9UxnJbqamSyJC7H6Dzz9s3n+x+fTVZNBtkQ0umHfOWT5fk46uaT053JsFD1aBbhiyw7nObBGxyFK8RY/R6Ja57TE3TbzWDR9/urz7FvPhdEJf61KoZ6StXyS1U6b339F0j5qZUbcyDFMK3UTDyuT7WjUkNSL55uZqn5UUTg0VYQ+II5txaBMbCvPuJbOKznEGeg/fej705+oa/wDEbo2Sw0FzNwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/e055571ce85dc16eb54bb723e9b9352b/fcda8/sendMsg.png\"\n        srcset=\"/static/e055571ce85dc16eb54bb723e9b9352b/12f09/sendMsg.png 148w,\n/static/e055571ce85dc16eb54bb723e9b9352b/e4a3f/sendMsg.png 295w,\n/static/e055571ce85dc16eb54bb723e9b9352b/fcda8/sendMsg.png 590w,\n/static/e055571ce85dc16eb54bb723e9b9352b/efc66/sendMsg.png 885w,\n/static/e055571ce85dc16eb54bb723e9b9352b/c83ae/sendMsg.png 1180w,\n/static/e055571ce85dc16eb54bb723e9b9352b/21482/sendMsg.png 1350w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>消息写入leader后，follower是主动的去leader进行同步。</li>\n<li>producer采用<strong>push模式</strong>将数据发布到broker，每条消息追加到分区中，顺序写入磁盘，保证同一分区内的数据是<strong>有序</strong>的。\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/857ce366a019424d99deba077205247f/c2d9c/writeMsg.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABYElEQVQoz3VSXW+CQBDk//+fPrYq2KTY2mj71oc2MRWQwh1wfIiC01k+jJr2wmQne3ezc8taGNbpdELbNFdoCG4gTVOEux0OdY22bbs9yfPr7o33BVYth45HhEUBN1ZYKH0FN4q7+KyTIafgkn9lWS90IdYJKq2Rc3NrDGzGeWau4CQJnLTPd5GwTY71LkSV57hd1khUWeLF9/EaBD38Pi49D8vLvOTCEAHPH/Z7VFUJbSpsVYlA57BiPiFnj77pcEIXM1YXTAc+SdIzlzilwwfyFUVriqaJgrP+xN0qwv2bB+s4NDii/Sc6WdCBwPWHSIcj70Du8rkbtmdPQUMjUVJg82PgxQZWMVj3WdVm0+dsuMDRwjXsOIajei7R4Y+z6fo9/KeHUqGuKgTcnPGwXJir/rJEO4rIx5zCo+Qo+ME2daNz+5dH5YJjU1FYWpCxyF8wLCo9V0TDeTzPr8zmgF9V7acRBnzx3gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/857ce366a019424d99deba077205247f/fcda8/writeMsg.png\"\n        srcset=\"/static/857ce366a019424d99deba077205247f/12f09/writeMsg.png 148w,\n/static/857ce366a019424d99deba077205247f/e4a3f/writeMsg.png 295w,\n/static/857ce366a019424d99deba077205247f/fcda8/writeMsg.png 590w,\n/static/857ce366a019424d99deba077205247f/efc66/writeMsg.png 885w,\n/static/857ce366a019424d99deba077205247f/c83ae/writeMsg.png 1180w,\n/static/857ce366a019424d99deba077205247f/c2d9c/writeMsg.png 1326w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>\n<p>写入原则</p>\n<ul>\n<li>按指定partition写入</li>\n<li>按key的hash值算出partition写入</li>\n<li>没有设置key，轮询选出一个partition</li>\n</ul>\n</li>\n<li>\n<p>消息不丢失</p>\n<ul>\n<li>0。不需要等到集群返回，不能保证消息发送成功。</li>\n<li>1。只要leader应答就可以发送下一条，只确保leader发送成功</li>\n<li>all。需要所有follower都完成leader的同步才会发送下一条，确保leader发送成功和所有的副本完成备份</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"保存数据\"><a href=\"#%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>保存数据</h3>\n<blockquote>\n<p>顺序写入的方式将数据保存到磁盘</p>\n</blockquote>\n<h4 id=\"partition结构\"><a href=\"#partition%E7%BB%93%E6%9E%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>partition结构</h4>\n<blockquote>\n<p>以文件夹的方式在服务器中存储</p>\n</blockquote>\n<h4 id=\"message结构\"><a href=\"#message%E7%BB%93%E6%9E%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>message结构</h4>\n<ol>\n<li>offset。占8byte的有序id号，唯一确定每条消息在partition内的位置</li>\n<li>消息大小</li>\n<li>消息体。</li>\n</ol>\n<h4 id=\"存储策略\"><a href=\"#%E5%AD%98%E5%82%A8%E7%AD%96%E7%95%A5\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>存储策略</h4>\n<ol>\n<li>基于时间，默认7天；</li>\n<li>基于大小，默认128MB;</li>\n</ol>\n<h3 id=\"消费数据\"><a href=\"#%E6%B6%88%E8%B4%B9%E6%95%B0%E6%8D%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>消费数据</h3>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f621570a5670beaf3b6b66ef87df287/21482/consumer-msg.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABuklEQVQoz12S647aMBCF8/7PU6lSu6VSl8BCYSmI6y5iIQlxfAuQhASSwOkJ3V+1NPLI9pz5fGwHn6O+3XCpK1zrmsG5qlByLT2nMLHFKTvjmKaPOGUZsvMZN+7/P5yMm+npBO94hKs0XrSGqy1zwznGJnrFRCzwKzJoRxGeQ4Euz0SHA25sXlclqusFdXlFVV7g5EWBgt2iJMFIKowotNZbrM0OIwrPjcDMKIyNwUQbjNl0SrG4ISXEdO1jON/gdbHBaLGlYJ4jJ6Wg4EBKDEj1Fs4w88boCYU+ifpC4HcYMg/R2+8xiCQsBUPmrYnA16GPL/0PPE0iOGfSZRQLeW1XGmz0EisxQ2sboBsE6PgB3GAP198/8rbnoUthRTpFgJ9Tie9jiW9/BFozDaei+Y0XxyLHJsmws3ss/XcsjcWCBXOl8KYEVip65HOurXh9FccQJHeXCj8mIZ5GHp4XFEwaL+iJ3xCyoKMs2lKjSz+7LG6TeiuHmMp37lt0+DA9a6F5vvFex0dIE0M1YQ9wmqe/3++Pb3IqLkgv/yL5jKysoK3Eh79DSOqATQUFJefmdsAdGaFyiqe07i8jXlKz63AcvQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/0f621570a5670beaf3b6b66ef87df287/fcda8/consumer-msg.png\"\n        srcset=\"/static/0f621570a5670beaf3b6b66ef87df287/12f09/consumer-msg.png 148w,\n/static/0f621570a5670beaf3b6b66ef87df287/e4a3f/consumer-msg.png 295w,\n/static/0f621570a5670beaf3b6b66ef87df287/fcda8/consumer-msg.png 590w,\n/static/0f621570a5670beaf3b6b66ef87df287/efc66/consumer-msg.png 885w,\n/static/0f621570a5670beaf3b6b66ef87df287/c83ae/consumer-msg.png 1180w,\n/static/0f621570a5670beaf3b6b66ef87df287/21482/consumer-msg.png 1350w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ol>\n<li>点对点模式。由消费者主动去kafka集群拉取消息</li>\n<li>消费者组consumer的数量与partition的数量一致</li>\n</ol>","timeToRead":3,"frontmatter":{"title":"kafka原理","date":"November 08, 2020","spoiler":"原理"},"fields":{"slug":"/kafka1/"}}},"pageContext":{"slug":"/kafka1/","previous":{"fields":{"slug":"/netty-memory/","directoryName":"netty-memory"},"frontmatter":{"title":"netty内存原理"}},"next":null}},"staticQueryHashes":["336482444"]}