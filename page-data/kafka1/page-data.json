{"componentChunkName":"component---src-templates-blog-post-js","path":"/kafka1/","result":{"data":{"site":{"siteMetadata":{"title":"FDW-blog","author":"kimifdw"}},"markdownRemark":{"id":"80e8678b-ff15-53a6-b613-b37bcb354fc4","html":"<h2 id=\"消息中间件好处\"><a href=\"#%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%A5%BD%E5%A4%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>消息中间件好处</h2>\n<ol>\n<li>解耦</li>\n<li>异步</li>\n<li>削峰</li>\n</ol>\n<h2 id=\"消息队列的通信模式\"><a href=\"#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%BC%8F\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>消息队列的通信模式</h2>\n<ol>\n<li>点对点。基于<strong>拉取</strong>或者<strong>轮询</strong>的消息传送模型，发送到队列的消息被一个且只有一个消费者进行处理\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/14dcd8ded1a86470488aae045bf38cf9/8d68c/msg-model1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhklEQVQoz3VSYU/CMBDt//9LoCYS4IMBhsgkgjARCXQbW7sNGGv37FUGiHjJy61Z792712P1YIiHaIQnf4IiP6CKsixP+RKXkaYpgrCJTXRnIeUcrLYe4N530eETZEkKrTWKovhDVJHR/ziOsd1uTRbgfgtrvwYe1CGTBdhBFcgNlLmolMJsNsN4PP6l8lI1YTqdYrlc2m9FtSq3oDODNkWEYy2RCiFOZFmWWez3e3smZYRzE1L9AwrWjT04ZvZxvIQqlCUkcM7hui48z8N8PsdgMLDKdrsd8jy3tlCOhQshuyZ3TeMArL4yHvIhuv47MmMyGU1qiKjX69nxyQbHcdDv95EkiZ2A7gkhjYdtrHjN+GgeJfkCI5MJpT77JaU8PU4URRb0EJUFpKwKW1seOQwFq0YkD4mAulO+FZWv1JBAZ63Lk02WsBm+oR1P8Bx4SGRi3kff3L/r9bHqNxHCTQeRaGETt4z6Fdgjf0XDH+El/Ph3qa9X6JI0CDv4XDxisWjA9z18A8n3AMxp+KKrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/14dcd8ded1a86470488aae045bf38cf9/fcda8/msg-model1.png\"\n        srcset=\"/static/14dcd8ded1a86470488aae045bf38cf9/12f09/msg-model1.png 148w,\n/static/14dcd8ded1a86470488aae045bf38cf9/e4a3f/msg-model1.png 295w,\n/static/14dcd8ded1a86470488aae045bf38cf9/fcda8/msg-model1.png 590w,\n/static/14dcd8ded1a86470488aae045bf38cf9/efc66/msg-model1.png 885w,\n/static/14dcd8ded1a86470488aae045bf38cf9/c83ae/msg-model1.png 1180w,\n/static/14dcd8ded1a86470488aae045bf38cf9/8d68c/msg-model1.png 1234w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>发布订阅\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e2eaf44438e619673500081dc6e02c42/c929c/msg-model2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABoklEQVQoz31SDU/CMBDt//9FavxCIyZG1BiBbBIQZENg6/pBt7GtPK9FkBDjJZddm927916PtXiAu9UQ7ewdyqxwGJvN5t/zet1gvuhA6RbU6hbL5AnsPOnhWr/jhoCTLKWubeOueVcf3hljCKyEkgbT6B5SnUPqSwJ/AJP5Ctwo6MKgqRssFgv0+33UdY3j2AHGcYzhcEigFaqqpAGcMvM1c4xg4Zm5sNaCc74HbJpmny7cfZqmKMvyd5B1fdua9bJP9OQUoYxRkgwHWFOzlBLj8dgzcd8gCDCbzbzc0WiEKIpoyIb+m0DIN5LdpZyAXZCHLRniNg2Qisw3FEWB5XKJdruNMAwxGAzQ7Xa9FUopzzDLOITQNOSBAC8g1BV5+AhmihyKfMzLYi/BAbp08pIk8RbM53PyqCLf1n6AO28tqJDnilL7msHS6zV26yOF1tqz/C8cSyHE/pGcvS7dkT3xEZ7VGK9iAk6SHYO/1uV4daxtiLkkmT1amUfaxQ4yEYKdRi84/XrF9dcbzI/s4z08XupDZm6xP6cn+Pg4QxR38A1x+/5sLc/WCQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/e2eaf44438e619673500081dc6e02c42/fcda8/msg-model2.png\"\n        srcset=\"/static/e2eaf44438e619673500081dc6e02c42/12f09/msg-model2.png 148w,\n/static/e2eaf44438e619673500081dc6e02c42/e4a3f/msg-model2.png 295w,\n/static/e2eaf44438e619673500081dc6e02c42/fcda8/msg-model2.png 590w,\n/static/e2eaf44438e619673500081dc6e02c42/efc66/msg-model2.png 885w,\n/static/e2eaf44438e619673500081dc6e02c42/c83ae/msg-model2.png 1180w,\n/static/e2eaf44438e619673500081dc6e02c42/c929c/msg-model2.png 1218w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ol>\n<h2 id=\"kafka架构\"><a href=\"#kafka%E6%9E%B6%E6%9E%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kafka架构</h2>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/21d4b6cfae925ab6ec0709941adbad25/b67f3/kafka-architecture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC1klEQVQ4y02SSW8bRxCF+Tfzi3LJIccAhq8GgiCHIEBiA4TjBdZmUpTEbShySErD2XumZ98o8nNRcpAM8FBdU4VX9fp1L2xXrOMhaz0g7iz2dcnen3JUcw7KoLDHeMY5kTmk9Rc07ozOn0nPnEJ6Z1XNlecx1Bq7aenZzQ3OYYS9H+C1C9oyxd9O2JoL9OOEbH3JxpiwMw3S9VfUdoYltXA9RkU+m1hjxTEbFfEopD2dh1RFQ121hInHXgf8/Nbihzcxv31eocwB7+chX0wtZCNGiwfeTiKM9SO+YxGqhEzHJELsKEUvKNfoekdcSEP+QJMo3n1Z8+pvn9HtPbE54ve/HP545+Etrrm7W9E/c1gaayFx0WlGlWXkaYodhiK5GuO0t9ipSE4MqiRmcrHl7EPEbmHiTUe8/kXx+pXkcp7d7PjwMWM12aGUgxklrHzFgxA+iPReXiZybwf2LcTaIw8DlD0lDFdyh2PK7ZDIX0m+JN5cE7pXuOqcYHdJLMMvdcowLzgXwpXEnlcuUJ1J0C5F8ooiiKT5M5bTJ7TOKHYD3OATXvCRaH1BYP/KdvsT2v8TFShZQpPFETqKcAU9p5yJu3PcZopfm9TicmZZVF5GtlmSrYakbkzuxejFgEp5YmBDEli4tkWU5pRFQZrn2CdT8lLT1UeeOtDal2kBwZtPOD/20f0LMpFs96d4/xhkywGHruD0dXmECh0inaCF6LThsym7dIZTGtj5DDc3qVKNP7ghuDLQ92MhvCbaPj5DyxMqlEWZiwpvI3JDJuLyXLa7S1LMJKHXHguaYyZI6ahk9hPdoaDep1S1pqkTiiIiLxRtkwpZJO82omsyDtJbHPfk39FK3vPvW/zZAX/+JHGPN+tezv/COHB/pTAHmmBxlPzl3ymeeoP5d0z3qE0jLi9q3GmHK8VT9KYv8T+0PNxkPN7mzwT/r3mywG5aYk0zrHGOa6Z8AxKEv0iopXkSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/21d4b6cfae925ab6ec0709941adbad25/fcda8/kafka-architecture.png\"\n        srcset=\"/static/21d4b6cfae925ab6ec0709941adbad25/12f09/kafka-architecture.png 148w,\n/static/21d4b6cfae925ab6ec0709941adbad25/e4a3f/kafka-architecture.png 295w,\n/static/21d4b6cfae925ab6ec0709941adbad25/fcda8/kafka-architecture.png 590w,\n/static/21d4b6cfae925ab6ec0709941adbad25/efc66/kafka-architecture.png 885w,\n/static/21d4b6cfae925ab6ec0709941adbad25/c83ae/kafka-architecture.png 1180w,\n/static/21d4b6cfae925ab6ec0709941adbad25/b67f3/kafka-architecture.png 1338w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ol>\n<li>消费者组。同一个分区的数据只能被消费者组中的一个消费者消费；同一个消费者组的消费者可以消费同一个topic的不同分区的数据</li>\n</ol>\n<h2 id=\"工作流程分析\"><a href=\"#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>工作流程分析</h2>\n<h3 id=\"发送数据\"><a href=\"#%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>发送数据</h3>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e055571ce85dc16eb54bb723e9b9352b/21482/sendMsg.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 44.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCklEQVQozzWSyXLTQBRF89l8AEu2rNiyYUOlYBOSEIqAiWMpUjyQWLYla+qWZFuyjGV5lA9tEV7VrR4W5913u8/EqktvckNX3hBWGmkZQEVdRdRnH7bYS4NDZJJaPwgerwjbV5Tevboz2AmdbaixFxqrsM2Z2HRwt79w13dIWsxKrwYeFbCMnqlEk2Ok19r4TVbjRq2DaFFJjV3cUSCTbdSmEF3O5LpLjKH0iEAn3Qr+V6GAB3Fy8sBBPlDFBscXnfZb1cATMU9+hhXOCb3RP6BUIFkZiPInieiwyXLK9YY/Ya92cRqteoEepK6a6PV5F9yhWTHX/RU3gxX9gaWAmy6RAkYnh+k1rvGVPErqGFeJxd5vqLFVRkFTwTSqxKSamBzVulV3vjfGk1PcMCZwnlWGZUfBHgi2OiPlUKYWm2nGOpkwHxosEoc4HLLIZB36pv+NsnPJzmnUD1FMxkyCAfPIIRPKoUht5osZeZ7jZAbjuM3M9shFyKjT4u1FyJsPLu8+eTg9jWXvktS4oBh8JxveYgwk9+OSllviOEM1cmaTLaYsiyWeAtr2HZkvmY8dbO2W1+eCV+8lrz/GDHo6Ze8LuXnBvPWZSfMccxjTGC1pOgWOrYB+rr5N0cJd6kpNEq9N1umxdBwmlonwh0RxQBQFTG2DzLyqlRqXzB6vEfYTwhsSjgcE9m/+Av76jb3VfVaLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/e055571ce85dc16eb54bb723e9b9352b/fcda8/sendMsg.png\"\n        srcset=\"/static/e055571ce85dc16eb54bb723e9b9352b/12f09/sendMsg.png 148w,\n/static/e055571ce85dc16eb54bb723e9b9352b/e4a3f/sendMsg.png 295w,\n/static/e055571ce85dc16eb54bb723e9b9352b/fcda8/sendMsg.png 590w,\n/static/e055571ce85dc16eb54bb723e9b9352b/efc66/sendMsg.png 885w,\n/static/e055571ce85dc16eb54bb723e9b9352b/c83ae/sendMsg.png 1180w,\n/static/e055571ce85dc16eb54bb723e9b9352b/21482/sendMsg.png 1350w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>消息写入leader后，follower是主动的去leader进行同步。</li>\n<li>producer采用<strong>push模式</strong>将数据发布到broker，每条消息追加到分区中，顺序写入磁盘，保证同一分区内的数据是<strong>有序</strong>的。\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/857ce366a019424d99deba077205247f/c2d9c/writeMsg.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXUlEQVQoz2VS2W7CMBDM/39Q3zhVCQihqkTVPvShEm0OIJcTJzU5mI4dQgOsNNrJ2hnPrm3hEk3bQir1gOJ0QiQEvMMBWVmab0lU3K/jfD5fs4YlpYTixiDPMYsTzJP0go5Po8jkZ4qaOvdMU4G3OAYGog+CB+ZlmmLFzUMsKbBMurpZJ1+IDO88SGYZ2ovDPqyexBS1gwDr/d7ADrq88v2bulk7HPFdFGiqGmUh8XMU+HBzfHoCVhiGyHiyz5anWY55LjEbQLd3rTPPRI4x+YYzLdmVSGMstl94ej1isvX/HSbaoeth7fkXdNx2XdjebV2737HdX/5TEopORaGQlwpWymGXdKcdjulmwvkMMeIMdX1KbtY5wxGdOhyDYrv3YSk+gaaqEBUlnCjGJr6FE0bYDOov5A5fwE4W3Q3fC/ZE228orkPfuuLQDQb8RJ5z3hkF+yfTMlc0VNe1yX/bIKbxBzQm+gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/857ce366a019424d99deba077205247f/fcda8/writeMsg.png\"\n        srcset=\"/static/857ce366a019424d99deba077205247f/12f09/writeMsg.png 148w,\n/static/857ce366a019424d99deba077205247f/e4a3f/writeMsg.png 295w,\n/static/857ce366a019424d99deba077205247f/fcda8/writeMsg.png 590w,\n/static/857ce366a019424d99deba077205247f/efc66/writeMsg.png 885w,\n/static/857ce366a019424d99deba077205247f/c83ae/writeMsg.png 1180w,\n/static/857ce366a019424d99deba077205247f/c2d9c/writeMsg.png 1326w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>\n<p>写入原则</p>\n<ul>\n<li>按指定partition写入</li>\n<li>按key的hash值算出partition写入</li>\n<li>没有设置key，轮询选出一个partition</li>\n</ul>\n</li>\n<li>\n<p>消息不丢失</p>\n<ul>\n<li>0。不需要等到集群返回，不能保证消息发送成功。</li>\n<li>1。只要leader应答就可以发送下一条，只确保leader发送成功</li>\n<li>all。需要所有follower都完成leader的同步才会发送下一条，确保leader发送成功和所有的副本完成备份</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"保存数据\"><a href=\"#%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>保存数据</h3>\n<blockquote>\n<p>顺序写入的方式将数据保存到磁盘</p>\n</blockquote>\n<h4 id=\"partition结构\"><a href=\"#partition%E7%BB%93%E6%9E%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>partition结构</h4>\n<blockquote>\n<p>以文件夹的方式在服务器中存储</p>\n</blockquote>\n<h4 id=\"message结构\"><a href=\"#message%E7%BB%93%E6%9E%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>message结构</h4>\n<ol>\n<li>offset。占8byte的有序id号，唯一确定每条消息在partition内的位置</li>\n<li>消息大小</li>\n<li>消息体。</li>\n</ol>\n<h4 id=\"存储策略\"><a href=\"#%E5%AD%98%E5%82%A8%E7%AD%96%E7%95%A5\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>存储策略</h4>\n<ol>\n<li>基于时间，默认7天；</li>\n<li>基于大小，默认128MB;</li>\n</ol>\n<h3 id=\"消费数据\"><a href=\"#%E6%B6%88%E8%B4%B9%E6%95%B0%E6%8D%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>消费数据</h3>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f621570a5670beaf3b6b66ef87df287/21482/consumer-msg.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABrUlEQVQoz22RW2/aQBCF/f9/UB7SVK2UYpdLCxhIDA6y8XW9FxtfoFHscHqgTZ+60tGMdrVnvpmx+r7HQKnzGWHX4dCdqO6mmHeJ2MITCTxt4CmFZ6nwYgyOdY3/HatpW3RNg11VwVYaE360dQlHGYyZH3IH0zzENyExygUesxwzrVEdj/x+weW9x2Xo/8T3AdbpdMKvKx0NfxYSSxLsVYgnlWEhNXY6wVorLFnMJeGC71vStezAlBXWfgR3G2C1C7GmrI4PZ5ruaTiVBauXCNIZ3HSHManGeYGJEKTMMaG+ZxmWJGzbBn4Q45MrcDcNcDeL8LBIYV0rnamXqoRNg0RvMI+3+BpEcJIEdhxTjFGMEfV4iDCjcd3UCKIMDyuJ+wWjW+Czm8N6+7sUQdN9y2UIH14W4pnze5LyJo/kH/mmKOBzKWVpEMQZvmwU7uckXTJf0bDmPK5L8dmywxnZ0mBEUocfbcopBJJigh8ygcP52Wx/XpYkbNA0LTJZIi3Mv2j1w4CBal9foThLwwV9SFMV75M8QJBniDi7AylTU0KT8nr6/g2nruUeulv8DV+kUBlDJ7emAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/0f621570a5670beaf3b6b66ef87df287/fcda8/consumer-msg.png\"\n        srcset=\"/static/0f621570a5670beaf3b6b66ef87df287/12f09/consumer-msg.png 148w,\n/static/0f621570a5670beaf3b6b66ef87df287/e4a3f/consumer-msg.png 295w,\n/static/0f621570a5670beaf3b6b66ef87df287/fcda8/consumer-msg.png 590w,\n/static/0f621570a5670beaf3b6b66ef87df287/efc66/consumer-msg.png 885w,\n/static/0f621570a5670beaf3b6b66ef87df287/c83ae/consumer-msg.png 1180w,\n/static/0f621570a5670beaf3b6b66ef87df287/21482/consumer-msg.png 1350w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ol>\n<li>点对点模式。由消费者主动去kafka集群拉取消息</li>\n<li>消费者组consumer的数量与partition的数量一致</li>\n</ol>","timeToRead":3,"frontmatter":{"title":"kafka原理","date":"November 08, 2020","spoiler":"原理"},"fields":{"slug":"/kafka1/"}}},"pageContext":{"slug":"/kafka1/","previous":{"fields":{"slug":"/netty-memory/","directoryName":"netty-memory"},"frontmatter":{"title":"netty内存原理"}},"next":{"fields":{"slug":"/netty-server/","directoryName":"netty-server"},"frontmatter":{"title":"netty server"}}}},"staticQueryHashes":["336482444"]}