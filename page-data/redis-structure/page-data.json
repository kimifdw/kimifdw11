{"componentChunkName":"component---src-templates-blog-post-js","path":"/redis-structure/","result":{"data":{"site":{"siteMetadata":{"title":"F&Y-BLOG","author":"kimifdw"}},"markdownRemark":{"id":"1e1ebff6-bd8b-5565-a8c8-70656e0bb2dc","html":"<h1 id=\"数据类型\"><a href=\"#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>数据类型</h1>\n<h2 id=\"keys\"><a href=\"#keys\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>keys</h2>\n<ol>\n<li>二进制安全，空字符串也是有效的键</li>\n<li>\n<p>规则</p>\n<ul>\n<li>键不能太长。可以使用 SHA1 来对大值进行处理</li>\n<li>键也不能太短。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"自动创建和删除键\"><a href=\"#%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4%E9%94%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>自动创建和删除键</h3>\n<ol>\n<li>\n<p>规则。</p>\n<ul>\n<li>添加到聚合数据类型时，如果目标键不存在，则在添加元素之前会创建一个空的聚合数据类型。</li>\n<li>删除聚合数据类型中的元素时，如果该值保持为空，则键将被自动销毁</li>\n<li>调用带空键的只读或写命令删除元素，总会产生与键保持空的聚合类型相同的结果</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"expires\"><a href=\"#expires\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>expires</h2>\n<ol>\n<li>到期时间分辨率始终为<strong>1 毫秒</strong></li>\n</ol>\n<h3 id=\"lru-算法\"><a href=\"#lru-%E7%AE%97%E6%B3%95\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LRU 算法</h3>\n<ol>\n<li>配置<code class=\"language-text\">maxmemory</code>来限制 redis 的内存使用，超过部分执行策略来释放内存</li>\n</ol>\n<h2 id=\"外部数据结构\"><a href=\"#%E5%A4%96%E9%83%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>外部数据结构</h2>\n<h3 id=\"string（字符串）\"><a href=\"#string%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STRING（字符串）</h3>\n<ol>\n<li>二进制安全，最大长度为 512MB</li>\n<li>\n<p>编码为 int/raw/embstr</p>\n<ul>\n<li>embstr。字符串对象的长度小于<strong>44</strong>字节，使用 embstr 对象。创建只会分配一次内存，使用 malloc 方法一次分配</li>\n<li>raw。需要使用两次 malloc 方法，两个对象头在内存地址上一般不是连续的</li>\n</ul>\n</li>\n<li>\n<p>sds（Simple Dynamic String）字符串结构。string 的底层实现</p>\n<ul>\n<li>可动态扩展内存</li>\n<li>二进制安全</li>\n<li>兼容传统的 C 语言字符串类型</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"list（列表）\"><a href=\"#list%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LIST（列表）</h3>\n<ol>\n<li>根据插入<strong>顺序排序</strong>的字符串元素的集合，基于<strong>双向链表</strong>实现。插入或删除快，查找慢。</li>\n<li>\n<p>方法</p>\n<ul>\n<li><code class=\"language-text\">LPUSH</code>命令将新元素从列表的<strong>头部</strong>添加</li>\n<li><code class=\"language-text\">RPUSH</code>命令将新元素从列表的<strong>尾部</strong>添加</li>\n<li><code class=\"language-text\">LTRIM</code>命令限制列表可查看的数据量</li>\n<li><code class=\"language-text\">BRPOP</code>和<code class=\"language-text\">BLPOP</code>。仅当将元素添加到列表中或用户指定的超时时间到时，能等待元素到来而不是采用轮训的方式。</li>\n</ul>\n</li>\n<li>列表的最大长度是 2^32-1 个元素（一个列表多达 40 多亿的数据）</li>\n<li>\n<p>编码为<strong>ziplist</strong>或<strong>linkedlist</strong></p>\n<ul>\n<li>ziplist。压缩链表，节省内存空间【数据量不能太大】</li>\n<li>linkedlist。双向链表</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"hash（哈希）\"><a href=\"#hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HASH（哈希）</h3>\n<ol>\n<li>由与值相关联的字段组成的映射。字段和值都是字符串</li>\n<li>\n<p>方法</p>\n<ul>\n<li><code class=\"language-text\">HINCRBY</code>。按增量递增存储在键处存储的哈希中字段中存储的数字，返回的是增加操作后的值</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"set（集合）\"><a href=\"#set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SET（集合）</h3>\n<ol>\n<li>唯一、未排序的字符串元素的集合。结构底层也为 dict</li>\n</ol>\n<h3 id=\"zset（排序集合）\"><a href=\"#zset%EF%BC%88%E6%8E%92%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ZSET（排序集合）</h3>\n<ol>\n<li>每个字符串元素都与一个浮点数字值相关联</li>\n</ol>\n<h3 id=\"bit-arrays（位图）\"><a href=\"#bit-arrays%EF%BC%88%E4%BD%8D%E5%9B%BE%EF%BC%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bit arrays（位图）</h3>\n<ol>\n<li>像位数组一样处理字符串</li>\n</ol>\n<h3 id=\"hyperloglogs（概率数据结构）\"><a href=\"#hyperloglogs%EF%BC%88%E6%A6%82%E7%8E%87%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HyperLogLogs（概率数据结构）</h3>\n<ol>\n<li>用于估计集合的基数</li>\n</ol>\n<h3 id=\"streams（流）\"><a href=\"#streams%EF%BC%88%E6%B5%81%EF%BC%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>streams（流）</h3>\n<ol>\n<li>抽象日志数据类型，仅追加 map 数据类型的集合</li>\n</ol>\n<h2 id=\"内部数据结构\"><a href=\"#%E5%86%85%E9%83%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>内部数据结构</h2>\n<h3 id=\"sds\"><a href=\"#sds\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sds</h3>\n<ol>\n<li>内部结构\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/73222ccd8ee4fe424839918648b5658a/7608e/sds-struct.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 68.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABL0lEQVQoz43SiW6DMAwA0P7/P25rtakHUJo4PpKQhDqlReo6yiywIoGTh/HGGPNz6r9b01jqHXdAFrG1ziLFOYLXu5QyPscmhGCAwdGQcsr6Qsk5p5RyjSnfF+P4Umyt7YEa9E48EvYoHCJI1KyPX097KhYfv3bHfWt6p2AXRKuRCbwQkUNyLKSShWIRSx6wsodc9FJzTGnI+g155WSw0F1cA2JZ2XRGvrGD87HcSkte3GLjQ/zcHg+t0T4DkWdU8MwmQhFFDX8XMwtUNs/s4f9s+4utDfKVjZWdpz/3lr2b2Ry4Ou9srGzmd2wGDg/2eJPnqOtpYla6DdCe7QnEkDjCzhH7ULstYeqzjpemxSH52B72zWXqtk6IsGJBHmwRTktDorONEph9eew/a1fZVx4nNFlGGgT/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/73222ccd8ee4fe424839918648b5658a/fcda8/sds-struct.png\"\n        srcset=\"/static/73222ccd8ee4fe424839918648b5658a/12f09/sds-struct.png 148w,\n/static/73222ccd8ee4fe424839918648b5658a/e4a3f/sds-struct.png 295w,\n/static/73222ccd8ee4fe424839918648b5658a/fcda8/sds-struct.png 590w,\n/static/73222ccd8ee4fe424839918648b5658a/7608e/sds-struct.png 735w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>内存结构\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f7fe4bdcf97ea2227320e2cc1cbb1599/8ce52/sds-mem-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 42.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2klEQVQoz5WQwZLDIAhA+/8/uduO6XRMYrQqiiIWkx6ye2rfQWHGh8Cln4gx5pz7x1zOibV2MwYSpJRLKXmn7qSUvPdSHRGJ6L/MtVq9PPT6uOtgnQhiHk8FiZ87R7k/MvceAj4dYmV0AXP9om1qDQtR68wda6PGX8jOuWVZygAL4riwHOA7Ren2WIQEkjLzW15nfbtdp+mu1PTze531HEKQ9ciSjDESr+sKADKzUkrMbdvkHLK0C9YHkB8IkII22fmxiJ3WGp84p0NOmXyskGXwMSpEhESfzPwC36EP3cNGVjYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/f7fe4bdcf97ea2227320e2cc1cbb1599/fcda8/sds-mem-structure.png\"\n        srcset=\"/static/f7fe4bdcf97ea2227320e2cc1cbb1599/12f09/sds-mem-structure.png 148w,\n/static/f7fe4bdcf97ea2227320e2cc1cbb1599/e4a3f/sds-mem-structure.png 295w,\n/static/f7fe4bdcf97ea2227320e2cc1cbb1599/fcda8/sds-mem-structure.png 590w,\n/static/f7fe4bdcf97ea2227320e2cc1cbb1599/8ce52/sds-mem-structure.png 681w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>\n<p>按字符串的使用大小来设置多个头部格式，不按动态头部来设置</p>\n<ul>\n<li>header。</li>\n<li>len: 表示字符串的真正长度（不包含 NULL 结束符在内）。</li>\n<li>alloc: 表示字符串的最大容量（不包含最后多余的那个字节）。</li>\n<li>flags: <strong>总是占用一个字节</strong>。其中的最低 3 个 bit 用来表示 header 的类型</li>\n<li>字符串数组。</li>\n</ul>\n</li>\n<li>\n<p>动态扩容</p>\n<ul>\n<li>原则。新长度=(新增加长度+原长度)>(1024 _ 1024)?(新增长度+原长度) + (1024 _ 1024) :(新增加长度+原长度) * 2。可能会涉及对 header 类型的修改</li>\n<li>具体实现。</li>\n<li><code class=\"language-text\">sdsMakeRoomFor</code>方法实现扩容。</li>\n<li><code class=\"language-text\">sdscatlen</code>方法实现扩容策略。</li>\n</ul>\n</li>\n<li>\n<p>与 C 语言字符串的区别</p>\n<ul>\n<li>获取字符串长度：O(1)</li>\n<li>杜绝缓冲区溢出</li>\n<li>减少修改字符串时带来的内存重分配次数</li>\n</ul>\n</li>\n<li>\n<p>资料</p>\n<ul>\n<li><a href=\"http://zhangtielei.com/posts/blog-redis-sds.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">sds 数据结构详解（推荐）</a></li>\n<li><a href=\"https://blog.csdn.net/weixin_40318210/article/details/85316315\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SDS 扩容</a></li>\n<li><a href=\"https://github.com/redis/redis/blob/unstable/src/sds.c\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">sds 源文件 sds.c</a></li>\n<li><a href=\"https://github.com/redis/redis/blob/unstable/src/sds.h\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">sds 源文件 sds.h</a></li>\n<li><a href=\"https://blog.csdn.net/qq193423571/article/details/81637075\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">深入浅出 redis sds</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/269496479\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">全网最细节的 sds 讲解（推荐）</a></li>\n</ul>\n</li>\n</ol>\n<h3 id=\"dict\"><a href=\"#dict\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>dict</h3>\n<ol>\n<li>一个用于维护 key 和 value 映射关系的数据结构【基于哈希表的算法】，为解决算法中的查找问题。</li>\n<li>特点。采用<strong>增量式重哈希</strong>的方法，避免一次性对所有 key 进行重哈希，在查找、插入、删除时都会触发重哈希</li>\n<li>数据结构。定义两个哈希表用于重哈希\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/98a5df494574e10ebd687e1813061d50/e7dce/dict-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.78378378378378%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABW0lEQVQoz3WS627bMAyF8/4vt7YJ0GBNHCBo/cdrJEuiKF4kl3JaDO08AhJ04WfyHHm3/D98wEKaMmOfKcTyI2Fno9aGRWzRWqu2ae2+nqY/OcUwe8yQZh8TbMAW1+vr8XicpslYFrkfQgoEgYgKZmbKOf+EM0qMaRjOj09Pp5cXylEpL1X7pc2Ma1rb1LUj1lLK+dzh/X7/er0K06KshNZtgejnmZm3YUBJKQ/DYOTx+Rnmm2HdhlZ11S8iZsRm8Z2oidTL5fLw6+FwOIzjmwovSpq72hw8QcyFiTjEZAI3DBvH8ffp9O6cFZO1ycZotZWpgnceConzCXLZgM3RfHMVi6rU/lRtEfxMYSvvSvL+9o4ZN+AuMsQGsKjJW6xOjEhcfShNSgwQgawPXW//gb+HiDp3Y7Ru3NJqCj6sas0/+8D9L/oOt79+mr32TlUEsfdJpQDA/fzL/B4fdVW7zOzzlI8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/98a5df494574e10ebd687e1813061d50/fcda8/dict-structure.png\"\n        srcset=\"/static/98a5df494574e10ebd687e1813061d50/12f09/dict-structure.png 148w,\n/static/98a5df494574e10ebd687e1813061d50/e4a3f/dict-structure.png 295w,\n/static/98a5df494574e10ebd687e1813061d50/fcda8/dict-structure.png 590w,\n/static/98a5df494574e10ebd687e1813061d50/e7dce/dict-structure.png 653w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>扩容条件。当 hash 表中元素的个数等于第一维数组的长度时，触发扩容，扩容大小为原数组大小的 2 倍</li>\n<li>缩容条件。元素个数低于数组长度的 10%</li>\n<li>\n<p>资料</p>\n<ul>\n<li><a href=\"http://zhangtielei.com/posts/blog-redis-dict.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">dict 原理</a></li>\n</ul>\n</li>\n</ol>\n<h3 id=\"ziplist\"><a href=\"#ziplist\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ziplist</h3>\n<ol>\n<li>定义。是经过特殊编码的双向链表，存储字符串和整数值，整数被编码为实际整数，而不是一系列字符，按小端存储。是一个连续的内存空间，将一些必要的偏移量信息记录在节点里，能跳到上一个节点或下一个节点</li>\n<li>\n<p>内存结构\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/79bb55cd0fb810094d39a27bdcf3f0eb/08a84/ziplist-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 460px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 5.405405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAANklEQVQI1x2IAQoAIAjE+v9nS63uAsssGGOsuLuo1aYkMxL8ACjyrGbWx94HQB6u1UT7mBFxAdf8OY3d7gfrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/79bb55cd0fb810094d39a27bdcf3f0eb/08a84/ziplist-structure.png\"\n        srcset=\"/static/79bb55cd0fb810094d39a27bdcf3f0eb/12f09/ziplist-structure.png 148w,\n/static/79bb55cd0fb810094d39a27bdcf3f0eb/e4a3f/ziplist-structure.png 295w,\n/static/79bb55cd0fb810094d39a27bdcf3f0eb/08a84/ziplist-structure.png 460w\"\n        sizes=\"(max-width: 460px) 100vw, 460px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li><code class=\"language-text\">zlbytes</code>。表示 ziplist 占用的字节总数（4 个字节）</li>\n<li><code class=\"language-text\">zltail</code>。表示 ziplist 表中最后一项（entry）在 ziplist 中的偏移字节数。可以很方便地找到最后一项（不用遍历整个 ziplist），从而可以在 ziplist 尾端快速地执行 push 或 pop 操作。</li>\n<li><code class=\"language-text\">zllen</code>。数据项（entry）的个数，2^16-1（2 个字节）</li>\n<li><code class=\"language-text\">entry</code>。真正存放数据的数据项，长度不确定</li>\n<li>\n<p>内部结构</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d811aca91f24076588aded9f40e65394/6f3f2/entry-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 256px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 8.108108108108107%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAd0lEQVQI1yXIzQ3CIBQA4O6hM7iPLuBQPXQN4yA9GNveKDx4PxBLeZAYm/gdv44kQkDr/F502z4WPLH8x4Hj+C37MI6nabq83meWHiAfvwJqbV1MCVkCcVHNOSMzcQSPxxhjSGrV5zxfjbkvyy2mB1IOwVvA1toPbEtqQ/XXTrkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/d811aca91f24076588aded9f40e65394/6f3f2/entry-structure.png\"\n        srcset=\"/static/d811aca91f24076588aded9f40e65394/12f09/entry-structure.png 148w,\n/static/d811aca91f24076588aded9f40e65394/6f3f2/entry-structure.png 256w\"\n        sizes=\"(max-width: 256px) 100vw, 256px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li><code class=\"language-text\">prevlen</code>。记录上一个节点的长度</li>\n<li><code class=\"language-text\">encoding</code>。当前节点的编码规则</li>\n<li><code class=\"language-text\">data</code>。当前节点的值</li>\n</ul>\n</li>\n<li><code class=\"language-text\">zlend</code>。结束标识，固定值（255）</li>\n</ul>\n</li>\n<li>使用<code class=\"language-text\">quicklist</code>替代 ziplist 和 linkedlist。quicklist 将 linkedlist 按段切分，每一段使用 ziplist 让存储紧凑，多个 ziplist 之间使用双向指针串联起来</li>\n<li>\n<p>资料</p>\n<ul>\n<li><a href=\"http://zhangtielei.com/posts/blog-redis-ziplist.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Redis 内部数据结构详解(4)——ziplist</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000017328042\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">redis ziplist 源码分析</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000016901154\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">redis 源码分析</a></li>\n</ul>\n</li>\n</ol>\n<h2 id=\"资料\"><a href=\"#%E8%B5%84%E6%96%99\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>资料</h2>\n<ol>\n<li><a href=\"http://zhangtielei.com/posts/blog-redis-dict.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Redis 内部数据结构详解</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000022381177\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">值得一看的 35 个 Redis 面试题总结</a></li>\n<li><a href=\"https://www.cnblogs.com/shoshana-kong/tag/redis/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">redis 文章</a></li>\n<li><a href=\"https://redis.io/topics/data-types-intro\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">redis 官方文档</a></li>\n<li><a href=\"http://ifeve.com/redis-data-types/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">redis 官方文档译文</a></li>\n<li><a href=\"http://redisbook.com/index.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">redis 设计与实现</a></li>\n</ol>","timeToRead":8,"frontmatter":{"title":"redis数据集","date":"March 12, 2021","spoiler":"redis structure"},"fields":{"slug":"/redis-structure/"}}},"pageContext":{"slug":"/redis-structure/","previous":{"fields":{"slug":"/structure/","directoryName":"structure"},"frontmatter":{"title":"数据结构"}},"next":{"fields":{"slug":"/data-governance/","directoryName":"data-governance"},"frontmatter":{"title":"数据治理"}}}},"staticQueryHashes":["336482444"]}