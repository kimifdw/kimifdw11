{"componentChunkName":"component---src-templates-blog-post-js","path":"/G1/","result":{"data":{"site":{"siteMetadata":{"title":"F&Y-BLOG","author":"kimifdw"}},"markdownRemark":{"id":"f96959af-30d5-5744-9321-9ad107848cd7","html":"<h1 id=\"定义\"><a href=\"#%E5%AE%9A%E4%B9%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>定义</h1>\n<p>一种server-style的垃圾收集器，适用于具有大内存的多处理器计算器</p>\n<h1 id=\"名词定义\"><a href=\"#%E5%90%8D%E8%AF%8D%E5%AE%9A%E4%B9%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>名词定义</h1>\n<ol>\n<li>Garbage-First。执行并发全局标记，以确定整个堆中对象的活动性，进而了解哪些区域为空，优先收集区域为空较多的区域。即将收集和压缩活动集中在可能充满可回收对象的堆区域中</li>\n<li>\n<p>并发收集模式问题。</p>\n<ol>\n<li>应用程序分配对象的速度超过垃圾收集器可以回收可用空间的速度</li>\n<li>可用空闲空间块无法满足分配要求</li>\n</ol>\n</li>\n<li>\n<p>SATB。快照技术来找到所有活动对象，类似于CMS增量更新，采用三色标记算法。</p>\n<ol>\n<li>白。对象没有被标记，标记阶段结束后，会被当做垃圾回收掉</li>\n<li>灰。对象被标记，它的field还没有被标记或标记完</li>\n<li>黑。对象被标记，且它的所有field也被标记完了</li>\n</ol>\n</li>\n<li>卡表。Java HotSpot VM使用字节数组作为卡表，每个字节称为卡，卡与堆中的地址范围相对应。</li>\n<li>Humongous object。任何<strong>大于区域大小一半</strong>的对象，被直接分配到了老年代区域。</li>\n<li>RSet【Remembered Set】。辅助GC过程的一种结构，典型的空间换时间工具</li>\n<li>CSet【Collection Set】。记录了GC要收集的Region集合，集合里的Region是任意年代的。</li>\n</ol>\n<h1 id=\"优势\"><a href=\"#%E4%BC%98%E5%8A%BF\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>优势</h1>\n<ol>\n<li>将对象从堆的一个或多个区域复制到堆上的单个区域，并在此过程中压缩和释放内存</li>\n<li>不断减少碎片</li>\n<li>为运行需要大型堆（<strong>6GB或更大</strong>）且GC延迟有限的应用程序的用户提供解决方案，可预测的暂停时间低于0.5s</li>\n</ol>\n<h1 id=\"cmsg1\"><a href=\"#cmsg1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CMS=>G1</h1>\n<ol>\n<li>JAVA堆被实时数据占用>=50%</li>\n<li>对象分配率或提升率差异很大</li>\n<li>长时间垃圾收集或压缩暂停>0.5s</li>\n</ol>\n<h1 id=\"注意点\"><a href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>注意点</h1>\n<p>G1非实时收集器。</p>\n<h1 id=\"堆分区\"><a href=\"#%E5%A0%86%E5%88%86%E5%8C%BA\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>堆分区</h1>\n<blockquote>\n<p>Java对象堆被划分为多个大小相等的区域，1MB~32MB不等，不超过2048个区域，内存布局如下图所示</p>\n</blockquote>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a2b53499fd57f3679c33329ca3998a76/71ce0/memory-heap.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 463px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 66.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACV0lEQVQoz0WS208TURCH+1/zpi/og8ZEE9MQ9EESHwgaERCw1pYi0EJbSnfbvZ77bXcpQi90t8TUxGk36jzMmbPz+2Yyc7YwnU4nk8l4PJ79nqu2pQ+/kUEa3//CyX1yl06zdDjN2nToymF0N/s5mt5PJqPRCJD5fF5QUhGC7U7PatvH77ebL4t7lX7lh1vuiLanrLOGdWlvneL9ht/ydT9kGIVBECCE0jQtKKVlEl/sHpVWnnVcYrKsVtwsrxaRUFKq8sqT5vqGSiIlBMGEEEoYh4NzPpvNCl1yXbG0E1IuJAp8RVHVHzTlGGoLHe8+flVe32LGOEgckeFZkJS72vYppSTLsgJTsRNKxHhyO6hdsXNyU3r7+fDFRsi4VsJu9/x+IATzPLr36HXty0mooiDEnLNF5yQ2USStRqe+tX/SwV0SX9UurMpZ3VEuUcYIpXXbk24orj4dtBq9Lo4DRDlbwoSbQMa1vdOd1TXbdrXiva7rWF7VkpehafVQ0+E7Ld30DR/cdLE+sk0voIzR5cx0ULP1sZs0dep5gdDqZG2z+rSIuBCcv6sEHxv84DyoO9qTtz6RklN4HRh6ARsTMS4RJpzxgHF+PQip4CZGGAshMaGQxdCJC0rZ4uQCtg2FHx4eClprWB0KQxmb+oev35+/6cN8jIYIwXvAzkGP8aIVWRoE8BH8YtvGGMYYpFVkOtX65XbJC4kUCwzgZRMBWdDkZC5m+cL+wSBCjKgkJhjzJZBjeQnw9K/9h+M4llLCBaqASIpFDLPkHhil4O8SoBFLy8UQAPwHhZyYA2ETX1EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/a2b53499fd57f3679c33329ca3998a76/71ce0/memory-heap.png\"\n        srcset=\"/static/a2b53499fd57f3679c33329ca3998a76/12f09/memory-heap.png 148w,\n/static/a2b53499fd57f3679c33329ca3998a76/e4a3f/memory-heap.png 295w,\n/static/a2b53499fd57f3679c33329ca3998a76/71ce0/memory-heap.png 463w\"\n        sizes=\"(max-width: 463px) 100vw, 463px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ol>\n<li>年轻代。浅蓝色区域</li>\n<li>混合集合。深蓝色的旧区域</li>\n<li>正在收集部分。红色框标记</li>\n<li>幸存者区域。标有S</li>\n<li>巨大对象。标有H，在cleanup和Full gc阶段回收</li>\n</ol>\n<h1 id=\"暂停stw\"><a href=\"#%E6%9A%82%E5%81%9Cstw\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>暂停(STW)</h1>\n<ol>\n<li>年轻代STW只发生在年轻代</li>\n<li>mixed collection pauses.处理年轻代和老年代混合部分</li>\n</ol>\n<h1 id=\"启用方式\"><a href=\"#%E5%90%AF%E7%94%A8%E6%96%B9%E5%BC%8F\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>启用方式</h1>\n<ol>\n<li><code class=\"language-text\">-XX:+UseG1GC</code></li>\n<li><code class=\"language-text\">-XX:+ParallelGCThreads=&lt;N&gt;</code>。STW的工作线程数量，与服务器的核数有关，默认值按(cpu &#x3C;= 8) ? cpu : 3 + ((cpu * 5) / 8)</li>\n<li><code class=\"language-text\">-XX:G1MixedGCLiveThresholdPercent=&lt;N&gt;</code>。混合垃圾收集器中旧区域的占用阀值。</li>\n<li><code class=\"language-text\">-XX:+UnlockExperimentalVMOptions</code>。解锁实验性标志的值</li>\n<li>其他默认重要的参数配置\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/80f51ee3b9c2dd46223075099bffc6f6/e1250/import-property.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAAA6klEQVQoz01RC7LEIAjz/netgvjBV3f7gmhnMztbtIQkNFzXRcR/B2MMZi6l1LJRdyVidW2tvs2htda7fn6QM6cUyYAiJaK0DmDf9z3n9DYUQVWhhsP3QERijFkK5UqcQcMAXEo1zed5vA0UkAeufpXRjSzRJKFMGJR2bcAQ6HW4VQ14vGSflw2QKetn8OS9tznN9otQy+7wPECGbdPaaVdlqbGceTQAI7uBdw1YBGxellk4CzGTbwtmsMkF/xTY1CZDdtv+fkBDQhBgCW/tc6hh+P8YfjTltjpwdWzfbGq8ggPnuSof59Cu/yFKB4LljL5UAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/80f51ee3b9c2dd46223075099bffc6f6/fcda8/import-property.png\"\n        srcset=\"/static/80f51ee3b9c2dd46223075099bffc6f6/12f09/import-property.png 148w,\n/static/80f51ee3b9c2dd46223075099bffc6f6/e4a3f/import-property.png 295w,\n/static/80f51ee3b9c2dd46223075099bffc6f6/fcda8/import-property.png 590w,\n/static/80f51ee3b9c2dd46223075099bffc6f6/efc66/import-property.png 885w,\n/static/80f51ee3b9c2dd46223075099bffc6f6/c83ae/import-property.png 1180w,\n/static/80f51ee3b9c2dd46223075099bffc6f6/e1250/import-property.png 1786w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ol>\n<h1 id=\"标记周期\"><a href=\"#%E6%A0%87%E8%AE%B0%E5%91%A8%E6%9C%9F\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>标记周期</h1>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f35bfc7e2b954ae6028789f62c272800/50383/remark-life.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 23.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA70lEQVQY0yVQyYqDUBD0//8igpcIKojbRFxAEDyoIAb0ICpi4hp38KAzNaYPzeuqrup+TbRtW9d13/dxHCMXRREEwTiOVVUhg9227feKpml833+/33gfx3GeJ/F6vfI8tyzr5wrXdTVNE0WR4ziWZRVFMQwDplmWAQfoOM4wDEmSAPwXp2mKjvv9zvM8xtq2raoqRVEkSdI0Lcsy5mMvSZJut5uu65BFUYRFCFiCME0TSmiwNryezyd9hSAIj8ejLMswDMEyDIPJ6PE8DyDRdR2M8b1936dpQokToFzXdZ5ngJ/P5wuCRQkc54B+WZY/bLz9XUjvDGcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/f35bfc7e2b954ae6028789f62c272800/fcda8/remark-life.png\"\n        srcset=\"/static/f35bfc7e2b954ae6028789f62c272800/12f09/remark-life.png 148w,\n/static/f35bfc7e2b954ae6028789f62c272800/e4a3f/remark-life.png 295w,\n/static/f35bfc7e2b954ae6028789f62c272800/fcda8/remark-life.png 590w,\n/static/f35bfc7e2b954ae6028789f62c272800/50383/remark-life.png 740w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ol>\n<li>Initial marking phase（初始标记阶段）。年轻代垃圾回收器承载</li>\n<li>Root region scanning phase（根区域扫描阶段）。扫描初始标记阶段标记的幸存者区域</li>\n<li>Concurrent marking phase（<strong>并发标记阶段</strong>）。查找整个堆中可访问的活动的对象。</li>\n<li>Remark phase（标记阶段）。STW收集</li>\n<li>Cleanup phase（<strong>清理阶段【并发】</strong>）。执行计费和RSet清理的STW操作,清理部分为并发完成。</li>\n</ol>\n<h1 id=\"收集周期\"><a href=\"#%E6%94%B6%E9%9B%86%E5%91%A8%E6%9C%9F\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>收集周期</h1>\n<h2 id=\"混合收集\"><a href=\"#%E6%B7%B7%E5%90%88%E6%94%B6%E9%9B%86\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>混合收集</h2>\n<ol>\n<li>选定所有年轻代里的Region，外加根据global concurrent marking统计得出收集收益高的若干老年代Region</li>\n<li>\n<p>并非FULL GC，只能回收部分老年代的分区</p>\n<h2 id=\"年轻代\"><a href=\"#%E5%B9%B4%E8%BD%BB%E4%BB%A3\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>年轻代</h2>\n</li>\n<li>收集eden regions和survivor regions</li>\n<li>特定对象的目标区域取决于对象的年龄，升级到老年代</li>\n<li>对象包含在下一个年轻代或混合垃圾收集的CSet</li>\n</ol>\n<h1 id=\"推荐建议\"><a href=\"#%E6%8E%A8%E8%8D%90%E5%BB%BA%E8%AE%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>推荐建议</h1>\n<ol>\n<li>年轻代大小。避免使用<code class=\"language-text\">-Xmn</code>或<code class=\"language-text\">-XX:NewRatio</code>来显示设置年轻代大小</li>\n<li>\n<p>暂停时间目标。</p>\n<ol>\n<li>G1 GC的吞吐量目标是90%的应用时间+10%的垃圾收集时间</li>\n<li>并行收集器的吞吐量目标是99%的应用时间+1%的垃圾收集时间</li>\n</ol>\n</li>\n<li>\n<p>混合垃圾收集。</p>\n<ol>\n<li><code class=\"language-text\">-XX：InitiatingHeapOccupancyPercent</code>。用于更改标记阈值。</li>\n<li><code class=\"language-text\">-XX：G1MixedGCLiveThresholdPercent</code>和<code class=\"language-text\">-XX：G1HeapWastePercent</code>。用于更改混合垃圾回收决策。</li>\n<li><code class=\"language-text\">-XX：G1MixedGCCountTarget</code>和<code class=\"language-text\">-XX：G1OldCSetRegionThresholdPercent</code>。用于调整旧区域的CSet</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"gc问题日志\"><a href=\"#gc%E9%97%AE%E9%A2%98%E6%97%A5%E5%BF%97\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GC问题日志</h1>\n<p>overflow日志\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9efcb4091cd364a816695b38be536e27/5f4af/overflow-log.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 10.135135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsSAAALEgHS3X78AAAAS0lEQVQI1y1MgQ3AMAja/+dOBbRtMk1HoiAQn3OOpMqUkoBaUCTV1DMrR+DHWmtcdjGfvXdEdLsDszeAcDezuPAAMdym23yX7llVH6e/c7Ua9TThAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/9efcb4091cd364a816695b38be536e27/fcda8/overflow-log.png\"\n        srcset=\"/static/9efcb4091cd364a816695b38be536e27/12f09/overflow-log.png 148w,\n/static/9efcb4091cd364a816695b38be536e27/e4a3f/overflow-log.png 295w,\n/static/9efcb4091cd364a816695b38be536e27/fcda8/overflow-log.png 590w,\n/static/9efcb4091cd364a816695b38be536e27/5f4af/overflow-log.png 665w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ol>\n<li>原因。内存不足</li>\n<li>\n<p>解决方案</p>\n<ol>\n<li>增加<code class=\"language-text\">-XX：G1ReservePercent</code>选项的值（并相应增加总堆），以增加reserve memory 的保留内存量。</li>\n<li>通过减小<code class=\"language-text\">-XX：InitiatingHeapOccupancyPercent</code>的值来更早地开始标记周期。</li>\n<li>增加<code class=\"language-text\">-XX：ConcGCThreads</code>选项的值，以增加并行标记线程的数量。</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"资料参考\"><a href=\"#%E8%B5%84%E6%96%99%E5%8F%82%E8%80%83\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>资料参考</h1>\n<ol>\n<li><a href=\"https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/g1_gc_tuning.html#humongous\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Garbage-First Garbage Collector Tuning</a></li>\n<li><a href=\"https://cloud.tencent.com/developer/article/1459638\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">详解 JVM Garbage First(G1) 垃圾收集器</a></li>\n</ol>","timeToRead":5,"frontmatter":{"title":"Garbage-First Garbage Collector(G1)回收器","date":"February 27, 2021","spoiler":"G1"},"fields":{"slug":"/G1/"}}},"pageContext":{"slug":"/G1/","previous":{"fields":{"slug":"/cms/","directoryName":"cms"},"frontmatter":{"title":"Concurrent Mark Sweep(CMS)回收器"}},"next":null}},"staticQueryHashes":["336482444"]}