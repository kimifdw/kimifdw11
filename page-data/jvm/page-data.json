{"componentChunkName":"component---src-templates-blog-post-js","path":"/jvm/","result":{"data":{"site":{"siteMetadata":{"title":"FDW-blog","author":"kimifdw"}},"markdownRemark":{"id":"fece6b95-3651-5d31-b74c-3f530a7f3cc6","html":"<h2 id=\"运行时数据区域\"><a href=\"#%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>运行时数据区域</h2>\n<ol>\n<li>线程运行时不会因为扩展而导致内存溢出</li>\n<li>2.</li>\n</ol>\n<h3 id=\"程序计数器\"><a href=\"#%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>程序计数器</h3>\n<p>一块较小的内存空间，是当前线程所执行的字节码的行号指示器</p>\n<h3 id=\"java-虚拟机栈\"><a href=\"#java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>java 虚拟机栈</h3>\n<p>存放编译期可知的各种 java 基本数据类型、对象引用和 returnAddress 类型</p>\n<h3 id=\"本地方法栈\"><a href=\"#%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>本地方法栈</h3>\n<p>为虚拟机使用到的本地方法服务</p>\n<h3 id=\"java-堆\"><a href=\"#java-%E5%A0%86\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>java 堆</h3>\n<ol>\n<li>虚拟机所管理的内存中最大的一块</li>\n<li>被所有线程共享的一块内存区域</li>\n<li>唯一目的用于存放对象实例</li>\n</ol>\n<h3 id=\"方法区\"><a href=\"#%E6%96%B9%E6%B3%95%E5%8C%BA\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>方法区</h3>\n<ol>\n<li>被各个线程所共享的内存区域</li>\n<li>\n<p>用于存储被虚拟机加载的类型信息、常量、静态变量、即时编译器编译后的代码缓存等</p>\n<h3 id=\"永久代\"><a href=\"#%E6%B0%B8%E4%B9%85%E4%BB%A3\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>永久代</h3>\n<ol>\n<li>在 HotSpot 虚拟机上开发、部署程序</li>\n<li>存在<code class=\"language-text\">-XX:MaxPermSize</code>的上限</li>\n<li>逐步被本地内存所取代</li>\n</ol>\n<h4 id=\"运行时常量池\"><a href=\"#%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>运行时常量池</h4>\n<p>用于存放编译期生成的各种字面量与符号引用</p>\n<h3 id=\"元数据\"><a href=\"#%E5%85%83%E6%95%B0%E6%8D%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>元数据</h3>\n<ol>\n<li><code class=\"language-text\">-XX:MaxMetaspaceSize</code>。设置元空间最大值，默认为-1（只限制与本地内存大小）</li>\n<li><code class=\"language-text\">-XX:MetaspaceSize</code>。指定元空间的初始空间大小</li>\n<li><code class=\"language-text\">-XX:MinMetaspaceFreeRatio</code>。在垃圾收集之后控制最小的元空间剩余容量的百分比。</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"直接内存\"><a href=\"#%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>直接内存</h3>\n<p>分配不受 Java 堆大小的限制</p>\n<h2 id=\"内存划分\"><a href=\"#%E5%86%85%E5%AD%98%E5%88%92%E5%88%86\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>内存划分</h2>\n<ol>\n<li>\n<p>内存布局分为三个部分</p>\n<ol>\n<li>对象头。</li>\n<li>用于存储对象自身的运行时数据【Mark Word】</li>\n<li>类型指针。对象指向它的类型元数据的指针</li>\n<li>实例数据。对象真正的有效信息，在程序代码里面定义的各种类型的字段内容</li>\n<li>对齐填充，\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/06d9cb5b48eee09456f416b4c25cb5f5/41045/mem-struct.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 14.864864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAuElEQVQI1x2O2VKDQBBF8/+fptEqGZSwWRFMyAzMkswA4enY8tB1l66+fQ/x8cC6O23vqTtL3Qe+Wo2qrjTC685RnieMjazPJ2leBDe894QQ2LaNdV1ZlkX0nUOQxaAnsurGS3ZG1YaPcuCofsTTvAoe8468MWTiv3/2FN+GyQWcs6SUmOdEjFGe/AfKl8tgeMslrLpQSLu2tzTS9tTeUGW/66IZdp6Vv6hTx1VuxnFEayPBXsLCPn+IKt2b72QPIQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/06d9cb5b48eee09456f416b4c25cb5f5/fcda8/mem-struct.png\"\n        srcset=\"/static/06d9cb5b48eee09456f416b4c25cb5f5/12f09/mem-struct.png 148w,\n/static/06d9cb5b48eee09456f416b4c25cb5f5/e4a3f/mem-struct.png 295w,\n/static/06d9cb5b48eee09456f416b4c25cb5f5/fcda8/mem-struct.png 590w,\n/static/06d9cb5b48eee09456f416b4c25cb5f5/efc66/mem-struct.png 885w,\n/static/06d9cb5b48eee09456f416b4c25cb5f5/c83ae/mem-struct.png 1180w,\n/static/06d9cb5b48eee09456f416b4c25cb5f5/41045/mem-struct.png 2434w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ol>\n</li>\n<li>蓝色部分为 GC 主要工作区</li>\n<li>Direct Memory 中，分配内存不够时 GC 通过<code class=\"language-text\">Cleaner#clean</code>间接管理</li>\n<li>任何自动内存管理系统都会面临的步骤：为新对象分配空间，收集垃圾对象空间</li>\n</ol>\n<h2 id=\"分配对象\"><a href=\"#%E5%88%86%E9%85%8D%E5%AF%B9%E8%B1%A1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>分配对象</h2>\n<ol>\n<li><strong>空闲列表</strong>。从列表中足够大的空间划分给对象实例，并更新列表上的记录。通过额外的存储记录空闲的地址，将随机 IO 变为顺序 IO</li>\n<li><strong>碰撞指针</strong>。通过一个指针作为分界点，需要分配内存时，仅需把指针往空闲的一端移动与对象大小相等的距离，分配效率较高，但使用场景有限。【带空间压缩整理的收集器】</li>\n<li>虚拟机采用 CAS 配上失败重试的方式保证更新操作的原子性。</li>\n<li>本地线程分配缓存。每个线程在 Java 堆中预先分配一小块内存</li>\n</ol>\n<h2 id=\"收集对象\"><a href=\"#%E6%94%B6%E9%9B%86%E5%AF%B9%E8%B1%A1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>收集对象</h2>\n<h3 id=\"识别垃圾\"><a href=\"#%E8%AF%86%E5%88%AB%E5%9E%83%E5%9C%BE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>识别垃圾</h3>\n<ol>\n<li>引用计数法【早期使用】。对每个对象的引用进行计数，多线程环境下同步代价高，能处理循环引用问题。相互引用无法进行回收。</li>\n<li>\n<p><strong>可达性分析（引用链法）</strong>。从 GC Root 开始进行对象搜索，被搜索到的对象即为可达对象。</p>\n<ol>\n<li>可作为 GC Root 的对象。</li>\n<li>引用的对象</li>\n<li>类静态属性引用的对象</li>\n<li>常量引用的对象</li>\n<li>JNI 引用的对象</li>\n<li>内部的引用机制</li>\n<li>所有被同步锁持有的对象</li>\n<li>反映虚拟机内部情况的对象</li>\n</ol>\n</li>\n<li>\n<p>引用</p>\n<ol>\n<li>分类</li>\n<li>强引用。指程序代码中 new 的引用赋值</li>\n<li>软引用。一些有用但非必须的对象</li>\n<li>弱引用。比软引用更弱，生命周期为下一次垃圾收集为止</li>\n<li>虚引用。最弱的引用关系，为了能在这个对象被收集器回收时收到一个系统通知</li>\n</ol>\n</li>\n<li>任何对象的 finalize()方法都只会被系统自动调用一次</li>\n<li>\n<p>方法区回收</p>\n<ol>\n<li>废弃的常量。</li>\n<li>已回收的实例</li>\n<li>类加载器已被回收</li>\n<li>类对应的 java.lang.Class 对象没有在任何地方呗引用</li>\n<li>不再使用的类型</li>\n<li><code class=\"language-text\">-verbose:class</code>和<code class=\"language-text\">-XX:+TraceClassLoading</code>来查看类加载信息</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"hotspot-细节实现\"><a href=\"#hotspot-%E7%BB%86%E8%8A%82%E5%AE%9E%E7%8E%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HotSpot 细节实现</h3>\n<ol>\n<li>根节点枚举都必须暂停用户线程（STW）；必须在一个能保障一致性的快照中得以进行</li>\n<li>\n<p>安全点。以是否具有让程序长时间执行的特征为标准进行选取</p>\n<ol>\n<li>抢先式中断。没有虚拟机采用</li>\n<li>主动式中断。设置标记，由各个执行线程不停地主动轮询，发现中断标志即就近的安全点进行挂起</li>\n</ol>\n</li>\n<li>安全区域。</li>\n<li>\n<p>记忆集与卡表</p>\n<ol>\n<li>记忆集。用于避免把整个老年代加进 GC Roots 扫描范围，用于记录从非收集区域指向收集区域的指针集合的抽象数据结构</li>\n<li>记忆精度包含字长精度、对象精度和卡精度【卡表】</li>\n<li>卡页。以2的N次幂的字节数</li>\n</ol>\n</li>\n<li>写屏障</li>\n<li>\n<p>并发的可达性</p>\n<ol>\n<li>\n<p>三色标记</p>\n<ol>\n<li>白色。对象尚未被垃圾收集器访问过</li>\n<li>黑色。已经被垃圾收集器访问过</li>\n<li>灰色。对象虽已被拉结收集器访问过，但对象本身仍存在至少一个引用</li>\n</ol>\n</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"收集算法\"><a href=\"#%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>收集算法</h3>\n<ol>\n<li>\n<p>Mark-Sweep（标记-清除）。</p>\n<ol>\n<li>追踪阶段。标记每个遇到的对象。</li>\n<li>清除阶段。将所有未标记的对象进行回收。</li>\n</ol>\n</li>\n<li>\n<p>Mark-Compact（标记-整理）。</p>\n<ol>\n<li>与 Mark-Sweep 第一阶段类似。</li>\n<li>按存活对象按照整理顺序进行整理。</li>\n</ol>\n</li>\n<li>Copying（复制）。通过碰撞指针的方式进行快速地分配内存。\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ccb04288e13ee17bf224c5bde716a81/fd561/shoujisuanfa.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 29.72972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzUlEQVQY022RSQ6FMAxDuf8lYQFlhtICYs7nRQqrj2S5TZvYLkmMUfq+l2maZBgGGcdRuSxL6bru26/rKtd1yXmef3Ech3LyPI/wwTTN86wCTdNInue6ruta3CvAYEQQ995/gqzpBcl936rMwGVZBMfbtuk+hKCXqFdVpQLOuXdgeM+iDmzbVoUwog6xanZpBBya233flWkyJxgwWP8X2awyCMYhkYxxwWVLAtubAZJQM2hkinZga0B0XBG1KArJskx/VpqmWscE98wt/T8VHM+vxXOzqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/3ccb04288e13ee17bf224c5bde716a81/fcda8/shoujisuanfa.png\"\n        srcset=\"/static/3ccb04288e13ee17bf224c5bde716a81/12f09/shoujisuanfa.png 148w,\n/static/3ccb04288e13ee17bf224c5bde716a81/e4a3f/shoujisuanfa.png 295w,\n/static/3ccb04288e13ee17bf224c5bde716a81/fcda8/shoujisuanfa.png 590w,\n/static/3ccb04288e13ee17bf224c5bde716a81/efc66/shoujisuanfa.png 885w,\n/static/3ccb04288e13ee17bf224c5bde716a81/c83ae/shoujisuanfa.png 1180w,\n/static/3ccb04288e13ee17bf224c5bde716a81/fd561/shoujisuanfa.png 2866w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ol>\n<h2 id=\"gc-评价标准\"><a href=\"#gc-%E8%AF%84%E4%BB%B7%E6%A0%87%E5%87%86\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GC 评价标准</h2>\n<ol>\n<li><strong>延迟（Latency）</strong>。最大停顿时间，即垃圾收集过程中一次 STW 的最长时间，越短越好，一定程度上可以接受频次的增大。</li>\n<li><strong>吞吐量（Throughput）</strong>。应用 GC 耗时占系统总运行时间的百分比，吞吐量优先的收集器可以接受较长的停顿。一次停顿的时间不超过应用服务的 TP9999，GC 的吞吐量不小于 99.99%</li>\n<li><strong>Footprint（资源量大小测量）</strong>。</li>\n<li><strong>反应速度</strong>。\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ccb04288e13ee17bf224c5bde716a81/fd561/pingjiabiaozhun.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 29.72972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzUlEQVQY022RSQ6FMAxDuf8lYQFlhtICYs7nRQqrj2S5TZvYLkmMUfq+l2maZBgGGcdRuSxL6bru26/rKtd1yXmef3Ech3LyPI/wwTTN86wCTdNInue6ruta3CvAYEQQ995/gqzpBcl936rMwGVZBMfbtuk+hKCXqFdVpQLOuXdgeM+iDmzbVoUwog6xanZpBBya233flWkyJxgwWP8X2awyCMYhkYxxwWVLAtubAZJQM2hkinZga0B0XBG1KArJskx/VpqmWscE98wt/T8VHM+vxXOzqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/3ccb04288e13ee17bf224c5bde716a81/fcda8/pingjiabiaozhun.png\"\n        srcset=\"/static/3ccb04288e13ee17bf224c5bde716a81/12f09/pingjiabiaozhun.png 148w,\n/static/3ccb04288e13ee17bf224c5bde716a81/e4a3f/pingjiabiaozhun.png 295w,\n/static/3ccb04288e13ee17bf224c5bde716a81/fcda8/pingjiabiaozhun.png 590w,\n/static/3ccb04288e13ee17bf224c5bde716a81/efc66/pingjiabiaozhun.png 885w,\n/static/3ccb04288e13ee17bf224c5bde716a81/c83ae/pingjiabiaozhun.png 1180w,\n/static/3ccb04288e13ee17bf224c5bde716a81/fd561/pingjiabiaozhun.png 2866w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ol>\n<h2 id=\"gc-cause\"><a href=\"#gc-cause\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GC Cause</h2>\n<ol>\n<li><strong>System.gc()</strong>。手动触发 GC 操作</li>\n<li>CMS。重点关注<strong>CMS Initial Mark</strong>和<strong>CMS Final Remark</strong>两个 STW 阶段</li>\n<li><strong>Promotion Failure</strong>。Old 区没有足够的空间分配给 Young 区晋升的对象。</li>\n<li><strong>Concurrent Mode Failure</strong>。Old 区预留的空间不足以分配给新的对象，此时收集器会发生退化，严重影响 GC 性能。</li>\n<li><strong>GCLocker Initiated GC</strong>。如果线程执行在 JNI 临界区时，刚好需要进行 GC，此时 GC Locker 将会阻止 GC 的发生，同时阻止其他线程进入 JNI 临界区，直到最后一个线程退出临界区时触发一次 GC。</li>\n</ol>\n<h2 id=\"是不是-gc-引发的问题\"><a href=\"#%E6%98%AF%E4%B8%8D%E6%98%AF-gc-%E5%BC%95%E5%8F%91%E7%9A%84%E9%97%AE%E9%A2%98\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>是不是 GC 引发的问题</h2>\n<ol>\n<li>时序分析。先发生的事件是根因的概率更大。</li>\n<li>概率分析。</li>\n<li>实验分析。</li>\n<li>反证分析。判断表象的发不发生跟结果是否有相关性。</li>\n<li>\n<p>问题点</p>\n<ol>\n<li>CPU 负载高。用火焰图看下热点</li>\n<li>慢查询增多。DB 情况</li>\n<li>线程 Block。锁竞争</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"应用类型\"><a href=\"#%E5%BA%94%E7%94%A8%E7%B1%BB%E5%9E%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>应用类型</h2>\n<ol>\n<li><strong>IO 交互型</strong>。互联网服务，对内存要求不大，大部分对象在 TP9999 的时间内都会死亡，Young 区越大越好。</li>\n<li><strong>MEM 计算型</strong>。分布式计算服务，对内存要求高，对象存活时间长，old 区越大越好\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2cb58cead979a75b0fe525c8ec842c69/5496c/application-service.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABMklEQVQoz2WSiW7DIBBE8/8fGVVppTZOzA2GBTxZ1kdaFWlkzsfs4MvzOeN6/cD9PsE5B6UUYozofWV1lFKgtWYZEJHMHVrX9Z8uY1NiwBjEuMD7hJwLWusiooroA68l6b/nSc6Mtn82YGYH7mcC7ZBat9tbayLp1/rL2TZ3uD2cncDCC5FLpRBQd0cbsJ/AXkn6pbw19h3tD3A49NYjs5pkVk8n67o5Di7DKK7EVXhW8I0zTZimh2R8wHZgxvRtMX9Z0ChZXHbOsclhaxliC6g2cdqpyLdwRLW209275EJw/BBJe4YaqEeCmROcSlhiRmUHNUUUa7kKh+I8iBX41edZSRQjz5yz9C+DOmznvCC5AP/UfNCwLBZj+CKDqBmWEkbeIn6kxOMBVEpL6bfbp/wJL6BMcL6quTN4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/2cb58cead979a75b0fe525c8ec842c69/fcda8/application-service.png\"\n        srcset=\"/static/2cb58cead979a75b0fe525c8ec842c69/12f09/application-service.png 148w,\n/static/2cb58cead979a75b0fe525c8ec842c69/e4a3f/application-service.png 295w,\n/static/2cb58cead979a75b0fe525c8ec842c69/fcda8/application-service.png 590w,\n/static/2cb58cead979a75b0fe525c8ec842c69/efc66/application-service.png 885w,\n/static/2cb58cead979a75b0fe525c8ec842c69/c83ae/application-service.png 1180w,\n/static/2cb58cead979a75b0fe525c8ec842c69/5496c/application-service.png 2452w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ol>\n<h2 id=\"问题分类\"><a href=\"#%E9%97%AE%E9%A2%98%E5%88%86%E7%B1%BB\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>问题分类</h2>\n<ol>\n<li>\n<p>Unexpected GC（意外发生的 GC）。</p>\n<ol>\n<li>Space Shock。空间动荡问题。JVM 参数中的<strong>-Xms</strong> 和<strong>-Xmx</strong>不一致时，每当空间不够时会发生一次 GC</li>\n<li>尽量将成对出现的空间大小配置参数设置成固定的，如 -Xms 和 -Xmx，-XX:MaxNewSize 和 -XX:NewSize，-XX:MetaSpaceSize 和 -XX:MaxMetaSpaceSize 等</li>\n<li>保证 Java 虚拟机的堆的稳定，确保-Xms 和-Xmx 设置成一个值，同理将 MetaSpace 区也可以设置成大小一致。</li>\n<li>Explicit GC。显示执行 GC 问题。</li>\n<li>CMS GC 共分为 Background 和 Foreground 两种模式</li>\n<li>-XX:+ExplicitGCInvokesConcurrent 和 -XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses，采用高性能的并发收集方式进行收集</li>\n</ol>\n</li>\n<li>\n<p>Partial GC。只对某些分代/分区进行回收</p>\n<ol>\n<li>Young GC。ParNew Young GC 频繁。</li>\n<li>Old GC。</li>\n<li>CMS old GC 频繁；</li>\n<li>Old GC 不频繁但单次耗时大</li>\n</ol>\n</li>\n<li>\n<p>FULL GC</p>\n<ol>\n<li>常规内存泄露问题的解题思路\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0deebded263887f5f390ee988ba9b043/5522e/solution.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 28.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAsklEQVQY021RCQ6EIAz0/z9VFOXGs+uMwbiEJg1NjzlCd56nXNfF3LZNcs6yriszpSTeewkhsi7977zcIoHVoSix74d8wzkv4ziJtU5acRz/+wSEqhgfdmvtqwbKpknLMCi+3gfuwEEI4Sbfb0LHXfRSyiToHiB3g0YeGmNlWQyVKTWK1vqtsQdgzAEyzwv34QR9An4t1xaguO8HHtWzVtBy+RREsVReWDLGkL3+gFYC6wdu99VXZ7HPWQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/0deebded263887f5f390ee988ba9b043/fcda8/solution.png\"\n        srcset=\"/static/0deebded263887f5f390ee988ba9b043/12f09/solution.png 148w,\n/static/0deebded263887f5f390ee988ba9b043/e4a3f/solution.png 295w,\n/static/0deebded263887f5f390ee988ba9b043/fcda8/solution.png 590w,\n/static/0deebded263887f5f390ee988ba9b043/efc66/solution.png 885w,\n/static/0deebded263887f5f390ee988ba9b043/c83ae/solution.png 1180w,\n/static/0deebded263887f5f390ee988ba9b043/5522e/solution.png 2680w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ol>\n</li>\n<li>MetaSpace。元空间回收引发的问题</li>\n<li>\n<p>Direct Memory。</p>\n<ol>\n<li>堆外内存泄露。通过 top 命令发现 Java 进程的 RES 甚至超过了-Xmx 的大小</li>\n<li>使用<code class=\"language-text\">gperftools</code>工具来追踪分配内存的命令(<a href=\"https://blog.csdn.net/10km/article/details/83820080\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">参考工具</a>)；</li>\n<li>使用<code class=\"language-text\">BTrace</code>定位具体的调用栈（<a href=\"https://www.cnblogs.com/fengzheng/p/7416942.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">参考工具</a>）。</li>\n<li>分析堆外内存问题如下：\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5ff39ee13de1ca0cf0efb168883531bb/8078c/out-memory.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 33.108108108108105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABCElEQVQoz3WSTXKEIBCFvf8Jsswhkk1OMFWzzglS0dERUfkH8YUGnDJTyeIJ1XY/Pp4227YhhPCv6P3RI4QE5xyMMRhjsO87YowPUV9DD+/9nyITay1sGjbWYWQTbn2PtruhHwbcxzGbk6Zpyr1NIQiIJ5Kz6bws2WiVGkJKLKvAKkSqr5lYKlWl4ZwvhspYrKkglalkxdw6B1+vrU0hbLsO322X9iz3HpEcMM0eN7xdPvHyfsHrxxXDNOPOOL66HkKbTB/q9YVU6Wo8G9Nhz3Flw4NQpmESYVMWpuZGq0/DlKMj4jpINa31r4gehkeG8fTFy+kBfJ6hUhy0Lim3kmHJjiXa57/iB0FEHpPDQO36AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/5ff39ee13de1ca0cf0efb168883531bb/fcda8/out-memory.png\"\n        srcset=\"/static/5ff39ee13de1ca0cf0efb168883531bb/12f09/out-memory.png 148w,\n/static/5ff39ee13de1ca0cf0efb168883531bb/e4a3f/out-memory.png 295w,\n/static/5ff39ee13de1ca0cf0efb168883531bb/fcda8/out-memory.png 590w,\n/static/5ff39ee13de1ca0cf0efb168883531bb/efc66/out-memory.png 885w,\n/static/5ff39ee13de1ca0cf0efb168883531bb/c83ae/out-memory.png 1180w,\n/static/5ff39ee13de1ca0cf0efb168883531bb/8078c/out-memory.png 2218w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ol>\n</li>\n<li>JNI</li>\n<li>GC 问题较难排查，需要谨慎使用</li>\n</ol>\n<h2 id=\"总结\"><a href=\"#%E6%80%BB%E7%BB%93\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>总结</h2>\n<h3 id=\"处理流程\"><a href=\"#%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>处理流程</h3>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a72e010d4769e76cf04ad56b2bf16c23/8fc63/SOP.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 29.054054054054056%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwklEQVQY032RjQ6DMAiEff9X1Wq1rfWv3vqxaLYljoQAHr0DbM7z1K9jy7KobTvFmJRzVtc5TVPQPGd57zWOU81n9cNg+XEcKqWo0YMBQkBEhAfEfd9NAGKwnBf7Rk5PA5hS0rZtdZqoEILWdau+ahi8RTB6mDal2Rwxavrh+CIEoKAxhFgVD1P1fjQy6ouMyd7C0QSd623Km/Dfyjwqdc1yFhNgZVuz3pcbX2fA7hs+/RRWZULUceecTXnhn3YJQfoCdqnWFF+qPR8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/a72e010d4769e76cf04ad56b2bf16c23/fcda8/SOP.png\"\n        srcset=\"/static/a72e010d4769e76cf04ad56b2bf16c23/12f09/SOP.png 148w,\n/static/a72e010d4769e76cf04ad56b2bf16c23/e4a3f/SOP.png 295w,\n/static/a72e010d4769e76cf04ad56b2bf16c23/fcda8/SOP.png 590w,\n/static/a72e010d4769e76cf04ad56b2bf16c23/efc66/SOP.png 885w,\n/static/a72e010d4769e76cf04ad56b2bf16c23/c83ae/SOP.png 1180w,\n/static/a72e010d4769e76cf04ad56b2bf16c23/8fc63/SOP.png 2756w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ol>\n<li>制定标准。需要结合应用系统的 TP9999 时间和延迟、吞吐量等设定具体的指标</li>\n<li>\n<p>保留现场。</p>\n<ol>\n<li>如果条件允许，一定不要直接操作重启、回滚等动作恢复</li>\n<li>优先通过摘掉流量的方式来恢复</li>\n</ol>\n</li>\n<li>因果分析。判断 GC 异常与其他系统指标异常的因果关系。</li>\n<li>根因分析。\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/426c8b9679768d5e7befd6e23a22d244/fa63f/result-fish.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 66.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABxElEQVQ4y41T207bQBDd/y3isV9SCfHAS6vSf2gF4r1V1QJFFAUF4ji2N/b6srbjJMDpmQ22HBMqLI08szNz5q5svcT/qKga9zdFBS+KO7n72xolgODzF9y924N6K2BGx/EsQpxZlIuVe2/J2TFgQZ3aetzBt3JeLjAONPy5cfwLHwYRUsNMhmB9xyDJkDITnRZI8nK79GdbNcyiL3elkY9MjtF05myqZu2Ac+qEMr4JCa+a1SOa5YMDECdPx5TXrmci1wRtmhXi3CJkhmGcOdCYGea0WdK2/dYPgLocT/DXm6FmVFOUmLFHF4HBvbHQSYqr0OB3mG4yIYAMRUqOCH5H8B+exsevJzg+OcP36xHU6c9znP26QMUMr4IE1zqDppOf5DinPNIpQsqSUUpAWZ85Af9Q56cWN36E/Q8HeH94hE/fTqEWLLdiWTeTKSNbGLvAlPsWxqnjSwaSYNI3TyeYkiIGS4ratUlaItVJ656esBmKRA4IYJ8HItOUKZa9KUrf7sO5W27T0/WnLINRw4m2fH8lIpNt+sYhSR937Wq3Nq8pugth1AkzEyCTVy8uqL+/QmrXVQxlWZlbP9g6u+FltfQP9Y/e8j9oMMcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/426c8b9679768d5e7befd6e23a22d244/fcda8/result-fish.png\"\n        srcset=\"/static/426c8b9679768d5e7befd6e23a22d244/12f09/result-fish.png 148w,\n/static/426c8b9679768d5e7befd6e23a22d244/e4a3f/result-fish.png 295w,\n/static/426c8b9679768d5e7befd6e23a22d244/fcda8/result-fish.png 590w,\n/static/426c8b9679768d5e7befd6e23a22d244/efc66/result-fish.png 885w,\n/static/426c8b9679768d5e7befd6e23a22d244/c83ae/result-fish.png 1180w,\n/static/426c8b9679768d5e7befd6e23a22d244/fa63f/result-fish.png 2298w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ol>\n<h3 id=\"调优建议\"><a href=\"#%E8%B0%83%E4%BC%98%E5%BB%BA%E8%AE%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>调优建议</h3>\n<ol>\n<li>Trade Off。优化在延迟(Latency)、吞吐量(Throughput)、容量(Capacity)三者之间进行权衡。</li>\n<li>最终手段。大部分情况下是通过 GC 的情况找出一些业务问题</li>\n<li>控制变量。每次调优过程尽可能只调整一个变量</li>\n<li>善用搜索。重点关注 StackOverFlow、Github 中的 issue 以及各种论坛博客</li>\n<li>调优重点。</li>\n<li>GC 参数。\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/288626be6f7542136e46ed209a9e2743/41045/param.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 33.108108108108105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABIklEQVQoz12RgY6DIBBE+f9PvCaX1LPWU0FQUUBhurvWpHckk01YeDsDqv6p0bYtqvsdkx1hjYYdqeqB1L81wFkL55yoqipoYzDyOeukZ0nzPEPxgW31iOaJ7bfC9vxGMC32dcHuJ6TZkEbk40ApBSVnxBgxviG8d61MPcVTBGg7BP1E6GsBRtuL0uKQGUTiC1ynaYLWWhxt2yZOeQj31LquiCEIMBIw6obctghdJTWneIJIF5ABwzAI1FB0TnkNVNxgaPIOcTKIbhBXieIeDCtnlPwB7LoOdV2L+r6H9ysCmdr3HYqnrN7LO8XxjM3vV/AX9Cl+O77HThnO0R19TkoJalkWyX9sXj5hJ6dcSznd/Bevx+OBr9sNTdMg0N1rcf8F69QcRpsbMyIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/288626be6f7542136e46ed209a9e2743/fcda8/param.png\"\n        srcset=\"/static/288626be6f7542136e46ed209a9e2743/12f09/param.png 148w,\n/static/288626be6f7542136e46ed209a9e2743/e4a3f/param.png 295w,\n/static/288626be6f7542136e46ed209a9e2743/fcda8/param.png 590w,\n/static/288626be6f7542136e46ed209a9e2743/efc66/param.png 885w,\n/static/288626be6f7542136e46ed209a9e2743/c83ae/param.png 1180w,\n/static/288626be6f7542136e46ed209a9e2743/41045/param.png 2434w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>禁用偏向锁。</li>\n</ol>\n<h2 id=\"资料\"><a href=\"#%E8%B5%84%E6%96%99\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>资料</h2>\n<ol>\n<li><a href=\"https://book.douban.com/subject/6809987/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">The Garbage Collection Handbook</a></li>\n<li>深入理解 Java 虚拟机</li>\n<li><a href=\"https://tech.meituan.com/2020/11/12/java-9-cms-gc.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">美团博客-CMS GC 问题上</a></li>\n</ol>","timeToRead":11,"frontmatter":{"title":"jvm cms","date":"December 07, 2020","spoiler":"jvm cms"},"fields":{"slug":"/jvm/"}}},"pageContext":{"slug":"/jvm/","previous":{"fields":{"slug":"/rest-atom/","directoryName":"rest-atom"},"frontmatter":{"title":"atom相关知识点"}},"next":{"fields":{"slug":"/linux-shell/","directoryName":"linux-shell"},"frontmatter":{"title":"linux指令集"}}}},"staticQueryHashes":["336482444"]}